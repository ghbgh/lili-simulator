<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>è‰è‰å›åˆåˆ¶æˆ˜æ–—æ¨¡æ‹Ÿå™¨</title>
  <style>
    body { font-family: sans-serif; background: #f7f7fa; color: #222; }
    .container { max-width: 1000px; margin: 40px auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px #ccc; padding: 24px; position: relative; }
    h2 { margin-top: 0; text-align: center; }
    .game-layout { display: flex; flex-direction: column; gap: 20px; }
    .top-layout { display: flex; gap: 20px; }
    .lili-section { flex: 1; background: #f9f9f9; padding: 15px; border-radius: 8px; }
    .lili-section .buttons { font-size: 16px; }
    .lili-section input[type="number"] { font-size: 16px; }
    .lili-section .animatable-stat { font-size: 16px; }
    .lili-section .stats > div { margin-bottom: 3px; }
    .lili-section .buttons > div { margin-bottom: 3px; }
    .lili-section .stats > div { margin-bottom: 3px; }
    .lili-section .buttons > div { margin-bottom: 3px; }
    .enhancement-section { flex: 1; background: #f0f0f0; padding: 15px; border-radius: 8px; }
    .minion-section { flex: 1; background: #e8f4f8; padding: 15px; border-radius: 8px; }
    .boss-section { flex: 1; background: #f0f0f0; padding: 15px; border-radius: 8px; }
    .battle-section { flex: 1.8; background: #f5f5f5; padding: 15px; border-radius: 8px; }
    .relics-section { background: #fff8dc; padding: 15px; border-radius: 8px; }
    .section-title { font-weight: bold; font-size: 18px; margin-bottom: 10px; color: #333; }
    
    /* å¼ºåŒ–é€‰é¡¹æ ‡ç­¾æ ·å¼ - æ¢è¡Œå¯¹é½åˆ°å¤é€‰æ¡†å³ä¾§ */
    .relics-section label {
      display: flex;
      align-items: flex-start;
      text-indent: 0;
      padding-left: 0;
    }
    
    .relics-section input[type="checkbox"] {
      margin-right: 8px;
      margin-top: 2px;
      flex-shrink: 0;
      width: 18px;
      height: 18px;
      transform: scale(1.3);
      pointer-events: auto;
    }
    
    /* è£…å¤‡åèƒŒæ™¯æ ·å¼ */
    .equipment-name {
      background-color: #2E7D32;
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
      display: inline-block;
      margin-right: 4px;
    }
    .equipment-name.orange {
      background-color: #F57C00;
    }
    .equipment-name.purple {
      background-color: #9C27B0;
    }
    .equipment-name.blue {
      background-color: #2196F3;
    }
    
    /* ç¦æ­¢labelæ–‡æœ¬ç‚¹å‡» */
    .relics-section label {
      pointer-events: none;
    }
    
    /* è£…å¤‡åèƒŒæ™¯æ ·å¼ */
    .equipment-name {
      background-color: #2E7D32;
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
      display: inline-block;
      margin-right: 4px;
    }
    .equipment-name.orange {
      background-color: #F57C00;
    }
    .equipment-name.purple {
      background-color: #9C27B0;
    }
    .equipment-name.blue {
      background-color: #2196F3;
    }
    
    /* å…è®¸labelæ–‡å­—ç‚¹å‡» */
    .relics-section label {
      pointer-events: auto;
    }
    .relics-section input[type="checkbox"] {
      pointer-events: auto;
    }
    
    .relics-section label > span,
    .relics-section label {
      line-height: 1.4;
    }
    .stats div { margin-bottom: 8px; }
    .buttons { display: flex; flex-direction: column; gap: 10px; margin-top: 10px; }
    .buttons > div { display: flex; align-items: center; gap: 5px; }
    .help-btn { background: #2196F3; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; position: absolute; top: 15px; right: 120px; }
    .help-btn:hover { background: #1976D2; }
    .refresh-btn { background: #e74c3c; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; position: absolute; top: 15px; right: 15px; }
    .refresh-btn:hover { background: #c0392b; }
    .boss-nav { margin-bottom: 2px; margin-top: 2px; display: flex; align-items: center; justify-content: center; gap: 5px; }
    .boss-img { width: 60px; height: 60px; background: #eee; border-radius: 8px; margin: 0 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; color: #bbb; }
    .boss-info div { margin-bottom: 6px; }
    .special { color: #b00; font-weight: bold; }
    .drop { color: #0a7; }
    .battle-result { font-size: 20px; font-weight: bold; margin-bottom: 10px; }
    
    /* éšè—åŸç”Ÿæ•°å­—è¾“å…¥æ¡†ç®­å¤´ */
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    input[type="number"] {
      -moz-appearance: textfield;
      appearance: textfield;
    }
    
    /* è‡ªå®šä¹‰å±æ€§è¾“å…¥æ¡†å®¹å™¨ */
    .stat-input-container {
      display: flex;
      align-items: center;
      gap: 2px;
      white-space: nowrap;
    }
    
    /* è‡ªå®šä¹‰å·¦å³ç®­å¤´æŒ‰é’® */
    .arrow-btn {
      width: 20px;
      height: 20px;
      border: 1px solid #ccc;
      background: linear-gradient(to bottom, #f8f8f8, #e8e8e8);
      color: #333;
      font-size: 12px;
      font-weight: bold;
      cursor: pointer;
      border-radius: 2px;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      margin: 0;
      padding: 0;
    }
    
    .arrow-btn:hover {
      background: linear-gradient(to bottom, #e8e8e8, #d8d8d8);
      border-color: #999;
    }
    
    .arrow-btn:active {
      background: linear-gradient(to bottom, #d8d8d8, #c8c8c8);
      box-shadow: inset 1px 1px 2px rgba(0,0,0,0.2);
    }
    
    input[type="number"]::-moz-outer-spin-button,
    input[type="number"]::-moz-inner-spin-button {
      -moz-appearance: initial;
    }
    .stat-highlight {
      background-color: #3498db !important;
      border: 2px solid #2980b9 !important;
      animation: statFlash 1s ease-out;
    }
    
    .animatable-stat {
      padding: 2px 4px;
      border-radius: 3px;
      transition: all 0.3s ease;
    }
    
    .animatable-stat.stat-highlight {
      background-color: #3498db !important;
      color: white !important;
      animation: statFlash 1s ease-out;
    }
    
    @keyframes statFlash {
      0% { 
        background-color: #3498db;
        border-color: #2980b9;
      }
      100% { 
        background-color: transparent;
        border-color: #ddd;
      }
    }
    input[type="number"] {
      transition: all 0.3s ease;
      border: 1px solid #ddd;
    }
    .victory-text {
      background-color: #27ae60;
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }
    .defeat-text {
      background-color: #e74c3c;
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }
    .boss-indicators {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      grid-template-rows: repeat(2, 1fr);
      gap: 3px;
      justify-items: center;
      margin-bottom: 0px;
      padding: 2px 10px;
      max-width: 180px;
      margin-left: auto;
      margin-right: auto;
    }
    .boss-dot {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: bold;
      color: white;
      text-shadow: 0 0 2px rgba(0,0,0,0.5);
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }
    .boss-dot.active {
      outline: 3px solid #3498db;
      outline-offset: 2px;
    }
    .boss-dot.victory {
      background-color: #27ae60;
    }
    .boss-dot.defeat {
      background-color: #e74c3c;
    }
    .boss-dot:hover {
      transform: scale(1.2);
    }
    
    /* è¿›åº¦æ¡æ ·å¼ */
    .progress-container {
      width: 100%;
      background: #ddd;
      border-radius: 10px;
      margin: 5px 0;
      position: relative;
      height: 20px;
      overflow: hidden;
    }
    
    .progress-bar {
      height: 100%;
      border-radius: 10px;
      transition: width 0.3s ease;
      position: relative;
    }
    
    .hp-bar {
      background: linear-gradient(90deg, #e74c3c 0%, #f39c12 50%, #27ae60 100%);
    }
    
    .pray-bar {
      background: linear-gradient(90deg, #3498db 0%, #9b59b6 100%);
    }
    
    .progress-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-weight: bold;
      font-size: 12px;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
      z-index: 1;
    }
    
    /* è¡Œå†…è¿›åº¦æ¡æ ·å¼ */
    .inline-progress-container {
      display: inline-block;
      width: 150px;
      background: #ddd;
      border-radius: 10px;
      margin-left: 10px;
      position: relative;
      height: 20px;
      overflow: hidden;
      vertical-align: middle;
    }
    
    /* æ‚¬æµ®çª—æ ·å¼ */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
    }
    .modal-content {
      background-color: #fefefe;
      margin: 5% auto;
      padding: 20px;
      border: 1px solid #888;
      border-radius: 8px;
      width: 80%;
      max-width: 750px;
      max-height: 80%;
      overflow-y: auto;
      position: relative;
    }
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      position: absolute;
      right: 15px;
      top: 10px;
    }
    .close:hover,
    .close:focus {
      color: #000;
      text-decoration: none;
    }
    .modal-title {
      margin-top: 0;
      margin-bottom: 20px;
      color: #333;
    }
  </style>
</head>
<body>
<div class="container">
  <h2>è‰è‰å›åˆåˆ¶æˆ˜æ–—æ¨¡æ‹Ÿå™¨</h2>
  <button class="help-btn" onclick="openHelpModal()">ä½¿ç”¨è¯´æ˜</button>
  <button class="refresh-btn" onclick="resetGame()">é‡ç½®æ¸¸æˆ</button>
  <div class="game-layout">
    <div class="top-layout">
      <!-- è‰è‰å±æ€§åŠå¼ºåŒ– -->
      <div class="lili-section">
        <div class="section-title">è‰è‰å±æ€§</div>
        <div class="stats">
          <div style="display: flex; align-items: center; white-space: nowrap;">
            ç¥ˆç¥·
            <div class="inline-progress-container">
              <div id="pray-bar" class="progress-bar pray-bar"></div>
              <div class="progress-text">
                <span id="pray-used" class="animatable-stat"></span> / <span id="pray-max" class="animatable-stat"></span>
              </div>
            </div>
          </div>
          <div class="buttons">
            <div class="stat-input-container">
              æ”»å‡»åŠ›ï¼š<button class="arrow-btn" onclick="adjustStat('atk', -1)">â—€</button><input type="number" id="input-atk" value="10" style="width:50px;text-align:center;font-size:16px;" onchange="setStat('atk')" oninput="animateInput(this)"><button class="arrow-btn" onclick="adjustStat('atk', 1)">â–¶</button><span id="atk-bonus" style="color:#27ae60;font-weight:bold;margin-left:5px;"></span>
            </div>
            <div class="stat-input-container">
              é˜²å¾¡åŠ›ï¼š<button class="arrow-btn" onclick="adjustStat('def', -1)">â—€</button><input type="number" id="input-def" value="5" style="width:50px;text-align:center;font-size:16px;" onchange="setStat('def')" oninput="animateInput(this)"><button class="arrow-btn" onclick="adjustStat('def', 1)">â–¶</button>
            </div>
            <div class="stat-input-container">
              æœ€å¤§è¡€é‡ï¼š<button class="arrow-btn" onclick="adjustStat('maxHp', -1)">â—€</button><input type="number" id="input-maxhp" value="100" style="width:70px;text-align:center;font-size:16px;" step="1" onchange="setStat('maxHp')" oninput="animateInput(this)"><button class="arrow-btn" onclick="adjustStat('maxHp', 1)">â–¶</button>
            </div>
            <div style="margin-top:3px;">
              <button style="padding:2px 6px;font-size:16px;" onclick="adjustMaxHp(-20)" title="ä¿®æ”¹è¡€é‡å’Œæœ€å¤§è¡€é‡ -20">-20ğŸ”—</button>
              <button style="margin-left:2px;padding:2px 6px;font-size:16px;" onclick="adjustMaxHpOnly(-5)" title="ä¿®æ”¹æœ€å¤§è¡€é‡ -5">-5</button>
              <button style="margin-left:8px;padding:2px 6px;font-size:16px;" onclick="adjustMaxHpOnly(5)" title="ä¿®æ”¹æœ€å¤§è¡€é‡ +5">+5</button>
              <button style="margin-left:2px;padding:2px 6px;font-size:16px;" onclick="adjustMaxHp(20)" title="ä¿®æ”¹è¡€é‡å’Œæœ€å¤§è¡€é‡ +20">+20ğŸ”—</button>
            </div>
            <div class="stat-input-container">
              å½“å‰è¡€é‡ï¼š<button class="arrow-btn" onclick="adjustStat('hp', -1)">â—€</button><input type="number" id="input-hp" value="100" style="width:70px;text-align:center;font-size:16px;" onchange="setStat('hp')" oninput="animateInput(this)"><button class="arrow-btn" onclick="adjustStat('hp', 1)">â–¶</button>
            </div>
            <div style="display: flex; align-items: center; white-space: nowrap;">
              è¡€é‡
              <div class="inline-progress-container">
                <div id="hp-bar" class="progress-bar hp-bar"></div>
                <div class="progress-text">
                  <span id="hp-display">100</span> / <span id="maxhp-display">100</span>
                </div>
              </div>
            </div>
            <div>
              æ±¡ç§½ç­‰çº§ï¼š<input type="number" id="input-corruption" value="0" style="width:70px;text-align:center;font-size:16px;" onchange="setStat('corruption')" oninput="animateInput(this)">
            </div>
            <div id="remaining-corruption" style="color:#666;font-size:14px;margin-top:5px;">
              TEå‰©ä½™å¯å¢åŠ æ±¡ç§½ç­‰çº§ï¼š<span id="remaining-corruption-value">59</span>
            </div>
            <div id="point-suggestion" style="color:#e74c3c;font-size:14px;margin-top:5px;font-weight:bold;display:none;">
              åŠ ç‚¹å»ºè®®ï¼š<span id="suggestion-text"></span>
            </div>
            <div style="text-align: center; margin-top: 10px;">
              <button onclick="resetStats()" style="padding:8px 16px;background:#27ae60;color:white;border:none;border-radius:4px;cursor:pointer;">é‡ç½®è¡€é‡å’Œç¥ˆç¥·</button>
            </div>
          </div>
        </div>
      </div>
      <!-- å°æ€ªåŒºåŸŸ -->
      <div class="minion-section">
        <div class="section-title">å°æ€ª</div>
        <div class="minion-info">
          <div>æ”»å‡»åŠ›ï¼š<span id="minion-atk"></span></div>
          <div>é˜²å¾¡åŠ›ï¼š<span id="minion-def"></span></div>
          <div>è¡€é‡ï¼š<span id="minion-hp"></span></div>
          <div>ç‰¹æ®Šï¼š<span class="special" id="minion-special"></span></div>
        </div>
        <button onclick="fightMinion()" style="margin-top:10px;padding:8px 16px;background:#3498db;color:white;border:none;border-radius:4px;cursor:pointer;">æŒ‘æˆ˜å°æ€ª</button>
        <div id="minion-result" style="margin-top:10px;font-weight:bold;"></div>
        <div id="minion-predict" style="margin-top:5px;color:#666;"></div>
      </div>
      <!-- Bossé€‰æ‹© -->
      <div class="boss-section">
        <div class="section-title">Bossä¿¡æ¯</div>
        <div class="boss-indicators" id="boss-indicators"></div>
        <div class="boss-nav" style="gap: 5px;">
          <button onclick="prevBoss()">â†</button>
          <div class="boss-img" id="boss-img">Boss</div>
          <button onclick="nextBoss()">â†’</button>
        </div>
        <div style="text-align: center; margin-bottom: 5px;">
        </div>
        <div class="boss-info">
          <div>Boss <span id="boss-num">1</span> / 10</div>
          <div>æ”»å‡»åŠ›ï¼š<span id="boss-atk"></span></div>
          <div>é˜²å¾¡åŠ›ï¼š<span id="boss-def"></span></div>
          <div>è¡€é‡ï¼š<span id="boss-hp"></span></div>
          <div>ç‰¹æ®Šï¼š<span class="special" id="boss-special"></span></div>
        </div>
      </div>
      <!-- æˆ˜æ–—é¢„æµ‹ -->
      <div class="battle-section">
        <div class="section-title">æˆ˜æ–—é¢„æµ‹</div>
        <div class="battle-result" id="battle-result"></div>
        <div id="hp-consumed"></div>
        <div style="margin-top:10px;">
          <b>å‰30è½®ä¼¤å®³è®°å½•ï¼š</b>
          <div id="damage-log" style="font-size:14px;white-space:pre-line;background:#fff;padding:8px;border-radius:6px;max-height:180px;overflow-y:auto;border:1px solid #ddd;"></div>
        </div>
      </div>
    </div>
    <!-- å¼ºåŒ–é€‰é¡¹åŒºåŸŸ -->
    <div class="relics-section">
      <div class="section-title">ç‰¹æ®Šé—ç‰©å¼ºåŒ–ï¼ˆä¸åŒ…æ‹¬ä½å±æ€§æˆ–æˆ˜æ–—æ— å…³é—ç‰©ï¼‰</div>
      <div style="display: flex; gap: 20px; margin-top: 5px;">
        <!-- å·¦åˆ— -->
        <div style="flex: 1.15; display: flex; flex-direction: column; gap: 2px;">
          <label><input type="checkbox" id="opt-pray-amount" onchange="updateUI()"><span><span class="equipment-name purple">ï¼ˆå„¿æ±è‰å¾·çš„æˆ’æŒ‡ï¼‰</span>ç¥ˆç¥·æ¢å¤é‡+10%</span></label>
          <label><input type="checkbox" id="opt-pray-amount5" onchange="updateUI()"><span><span class="equipment-name">ï¼ˆçº¯å‡€æ¸…æ³‰çš„åœ£æ°´ï¼‰</span>ç¥ˆç¥·æ¢å¤é‡+5%</span></label>
          <label><input type="checkbox" id="opt-pray-amount-10" onchange="togglePrayDefense()"><span><span class="equipment-name purple">ï¼ˆè‰å¯ä¸½ä¸çš„æˆ’æŒ‡ï¼‰</span>ç¥ˆç¥·æ¢å¤é‡-10%ï¼Œé˜²å¾¡åŠ›+4</span></label>
          <label><input type="checkbox" id="opt-pray-count" onchange="updateUI()"><span><span class="equipment-name orange">ï¼ˆç™½å·«å¥³å¨ƒå¨ƒï¼‰</span>ç¥ˆç¥·æ¬¡æ•°ä¸Šé™+1ï¼ˆç‰¹æ®Šæ•ˆæœï¼šæ¯æ¬¡ç¥ˆç¥·æ°¸ä¹…+4æœ€å¤§HPï¼‰</span></label>
          <label><input type="checkbox" id="opt-earring" onchange="updateUI()"><span><span class="equipment-name blue">ï¼ˆç™½å·«å¥³è€³ç¯ï¼‰</span>ç¥ˆç¥·æ¬¡æ•°ä¸Šé™+1</span></label>
          <label><input type="checkbox" id="opt-statue" onchange="updateUI()"><span><span class="equipment-name orange">ï¼ˆç™½å·«å¥³çš„é›•åƒï¼‰</span>ç¥ˆç¥·æ¬¡æ•°ä¸Šé™+1ï¼Œç¥ˆç¥·æ¢å¤ç”Ÿå‘½æ—¶ä¼šå¯¹æ•Œäººé€ æˆæ¢å¤é‡ä¸€åŠçš„ä¼¤å®³ï¼ˆä¼¤å®³è®¡ç®—é˜²å¾¡ï¼‰</span></label>
          <label><input type="checkbox" id="opt-molili" onchange="toggleMoliliRing()"><span><span class="equipment-name orange">ï¼ˆèŠ™è‰è’‚é›…çš„æˆ’æŒ‡ï¼‰</span>å—åˆ°æ”»å‡»æ—¶åå¼¹é˜²å¾¡åŠ›Ã—1ç‚¹ä¼¤å®³ï¼Œé˜²å¾¡+3</span></label>
          <label><input type="checkbox" id="opt-corrupted-crown" onchange="toggleCorruptedCrown()"><span><span class="equipment-name blue">ï¼ˆè…æœ½çš„ç‹å† ï¼‰</span>æ”»å‡»+4ï¼Œé˜²å¾¡+4ï¼Œæ±¡ç§½æ®‹æ¸£è·å–ç‡-40%</span></label>
          <label><input type="checkbox" id="opt-bloody-ribbon" onchange="toggleBloodyRibbon()"><span><span class="equipment-name purple">ï¼ˆè¡€æŸ“çš„è´è¶ç»“ï¼‰</span>æ”»å‡»+4ï¼Œç”Ÿå‘½ä¸Šé™-20</span></label>
        </div>
        <!-- å³åˆ— -->
        <div style="flex: 1; display: flex; flex-direction: column; gap: 2px;">
          <label><input type="checkbox" id="opt-rainbow-feather" onchange="toggleRainbowFeather()"><span><span class="equipment-name orange">ï¼ˆä¸ƒå½©ç¾½æ¯›å¤´é¥°ï¼‰</span>æ”»å‡»+2ï¼Œé˜²å¾¡+2ï¼Œç”Ÿå‘½ä¸Šé™+40</span></label>
          <label><input type="checkbox" id="opt-glove" onchange="toggleGlove()"><span><span class="equipment-name orange">ï¼ˆæ‰§è¡Œäººçš„æ‰‹å¥—ï¼‰</span>æ¯å›åˆæ”»å‡»ä¸¤æ¬¡ï¼Œæ”»å‡»-5</span></label>
          <label><input type="checkbox" id="opt-boss-atk" onchange="updateUI()"><span><span class="equipment-name purple">ï¼ˆç ´æŸçš„éŸ³ä¹ç›’ï¼‰</span>å¯¹å®ˆæŠ¤è€…æ”»å‡»åŠ›æé«˜2ç‚¹(boss1-7æœ‰æ•ˆ)</span></label>
          <label><input type="checkbox" id="opt-restraint" onchange="toggleMagicChain()"><span><span class="equipment-name">ï¼ˆé­”çº¿è„šé“¾ï¼‰</span>é¦–è½®ç¦é”¢æ•Œæ–¹ä½¿å…¶ä¸èƒ½æ”»å‡»ï¼Œé˜²å¾¡+1</span></label>
          <label><input type="checkbox" id="opt-immunity" onchange="toggleImmunityDefense()"><span><span class="equipment-name purple">ï¼ˆé›…è‹¥æ‹‰çš„æˆ’æŒ‡ï¼‰</span>å…ç–«éæ”»å‡»ç±»ä¼¤å®³ï¼Œé˜²å¾¡+3</span></label>
          <label><input type="checkbox" id="opt-swap-atk-def" onchange="toggleSwapAtkDef()"><span><span class="equipment-name purple">ï¼ˆçµæ¶¡æˆ’ï¼‰</span>äº¤æ¢æ”»å‡»å’Œé˜²å¾¡ï¼Œæ”»å‡»+2ï¼Œé˜²å¾¡+2</span></label>
          <label><input type="checkbox" id="opt-dragon-claw" onchange="toggleDragonClaw()"><span><span class="equipment-name orange">ï¼ˆå¤é¾™çˆªï¼‰</span>å‡å°‘50%é˜²å¾¡å¹¶å¢åŠ ä¸¤å€å‡å°‘çš„å€¼åˆ°æ”»å‡»åŠ›</span></label>
          <label><input type="checkbox" id="opt-corruption-atk" onchange="toggleCorruptionAtk()"><span><span class="equipment-name purple">ï¼ˆæ±¡ç§½çš„å¹»å½±ï¼‰</span>æ”»å‡»åŠ›+æ±¡ç§½ç­‰çº§Ã—0.1</span></label>
          <label><input type="checkbox" id="opt-corruption-def" onchange="toggleCorruptionDef()"><span><span class="equipment-name purple">ï¼ˆç‹ä¹‹ç›¾çš„å¾½ç« ï¼‰</span>é˜²å¾¡åŠ›+æ±¡ç§½ç­‰çº§Ã—0.1</span></label>
          <label><input type="checkbox" id="opt-corruption-hp" onchange="toggleCorruptionHp()"><span><span class="equipment-name purple">ï¼ˆè„æ±¡çš„é“¶å¿µç ï¼‰</span>ç”Ÿå‘½å€¼ä¸Šé™+æ±¡ç§½ç­‰çº§Ã—1</span></label>
        </div>
        <!-- éšè—æ—§ç‰ˆé“å…· -->
        <div style="display: none;">
          <label><input type="checkbox" id="opt-no-pray" onchange="updateUI()"> ï¼ˆæ—§ç‰ˆé“å…·ï¼‰ä¸èƒ½ä½¿ç”¨ç¥ˆç¥·</label>
          <label><input type="checkbox" id="opt-minion-atk" onchange="updateUI()"> ï¼ˆæ—§ç‰ˆé“å…·ï¼‰å¯¹å°æ€ªæ”»å‡»åŠ›æé«˜3ç‚¹</label>
          <label><input type="checkbox" id="opt-no-rest" onchange="updateUI()"><span><span class="equipment-name orange">ï¼ˆä¼ é€é­”çŸ³ï¼‰</span>bosså‰ä¿®æ•´ï¼ˆæœ€ç»ˆbosså‰å¯æ¢å¤ï¼‰</span></label>
        </div>
      </div>
    </div>
  </div>
  
  <!-- AI Copilot æ°´å° -->
  <div style="position:absolute;bottom:15px;right:20px;color:#888;font-size:16px;font-family:Arial,sans-serif;z-index:1000;pointer-events:none;font-weight:bold;">
    Powered By AI Copilot
  </div>
</div>
<script>
const lili = { atk: 10, def: 5, maxHp: 100, hp: 100, prayUsed: 0, corruption: 0 };
const bosses = [
  { atk: 14, def: 3, hp: 130, special: '', drop: 3 },
  { atk: 8, def: 4, hp: 150, special: 'æ¯æ¬¡æ”»å‡»å¢åŠ è‡ªç”Ÿatkä¸€ç‚¹', drop: 4 },
  { atk: 15, def: 7, hp: 180, special: 'æ¯å›åˆæ”»å‡»ä¸¤æ¬¡', drop: 5 },
  { atk: 12, def: 10, hp: 250, special: 'æ¯å›åˆç§»é™¤å¯¹æ–¹12hp', drop: 6 },
  { atk: 80, def: 14, hp: 300, special: 'æ¯ä¸‰å›åˆæ”»å‡»ä¸€æ¬¡', drop: 7 },
  { atk: 28, def: 15, hp: 350, special: 'æ¯æ¬¡å—ä¼¤æœ€é«˜10ç‚¹', drop: 8 },
  { atk: 44, def: 14, hp: 400, special: 'æ— è§†50%é˜²å¾¡', drop: 9 },
  { atk: 35, def: 35, hp: 450, special: 'hpä¸º0åå—åˆ°5æ¬¡æ”»å‡»æ­»äº¡(ä¸”æ­¤æ€ªç±»å‹ä¸ºæ±¡ç§½/å°æ€ª)', drop: 10 },
  { atk: 50, def: 35, hp: 600, special: 'æ°¸ä¹…å¢åŠ è‰è‰æ”»å‡»7ç‚¹(å‰ç½®è™šè¯†)', drop: '' },
  { atk: 70, def: 40, hp: 600, special: 'è¡€é‡å°äºç­‰äº25%æ—¶ä¸å†æ”»å‡»', drop: '' }
];
const minions = [
  { atk: 8, def: 2, hp: 40, special: '' },
  { atk: 9, def: 3, hp: 55, special: '' },
  { atk: 10, def: 4, hp: 80, special: '' },
  { atk: 11, def: 5, hp: 95, special: '' },
  { atk: 12, def: 6, hp: 115, special: '' },
  { atk: 13, def: 7, hp: 130, special: '' },
  { atk: 14, def: 8, hp: 150, special: '' },
  { atk: 15, def: 9, hp: 170, special: '' },
  { atk: 0, def: 10, hp: 200, special: 'ä¸ä¼šæ”»å‡»ï¼Œåå¼¹100%çœŸå®ä¼¤å®³' },
  { atk: 0, def: 0, hp: 0, special: 'æ— å°æ€ª' }
];
let bossIdx = 0;

function animateInput(element) {
  // ç§»é™¤ä¹‹å‰çš„åŠ¨ç”»ç±»
  element.classList.remove('stat-highlight');
  
  // å¼ºåˆ¶é‡ç»˜
  void element.offsetWidth;
  
  // æ·»åŠ åŠ¨ç”»ç±»
  element.classList.add('stat-highlight');
  
  // 1ç§’åç§»é™¤åŠ¨ç”»ç±»
  setTimeout(() => {
    element.classList.remove('stat-highlight');
  }, 1000);
}

function setStat(type, animate = false) {
  let val = 1;
  if (type === 'atk') val = parseInt(document.getElementById('input-atk').value)||1;
  if (type === 'def') val = parseInt(document.getElementById('input-def').value)||0;
  if (type === 'maxHp') val = parseInt(document.getElementById('input-maxhp').value)||20;
  if (type === 'hp') val = parseInt(document.getElementById('input-hp').value)||1;
  if (type === 'corruption') val = parseInt(document.getElementById('input-corruption').value)||0;
  
  if (type === 'atk') lili.atk = Math.max(1, val);
  if (type === 'def') lili.def = Math.max(0, val);
  if (type === 'maxHp') {
    let oldMaxHp = lili.maxHp;
    lili.maxHp = Math.max(20, val);
    // å½“æœ€å¤§è¡€é‡æ”¹å˜æ—¶ï¼Œå½“å‰è¡€é‡åŒæ­¥å¢å‡
    let hpDiff = lili.maxHp - oldMaxHp;
    lili.hp = Math.max(1, Math.min(lili.hp + hpDiff, lili.maxHp));
  }
  if (type === 'hp') lili.hp = Math.max(1, Math.min(val, lili.maxHp));
  if (type === 'corruption') {
    const oldCorruption = lili.corruption;
    lili.corruption = Math.max(0, val);
    
    // å½“æ±¡ç§½ç­‰çº§æ”¹å˜æ—¶ï¼Œé‡æ–°åº”ç”¨æ‰€æœ‰å·²å‹¾é€‰çš„æ±¡ç§½è£…å¤‡æ•ˆæœ
    if (oldCorruption !== lili.corruption) {
      updateCorruptionEffects(oldCorruption, lili.corruption);
    }
  }
  
  // å¦‚æœéœ€è¦åŠ¨ç”»æ•ˆæœ
  if (animate) {
    let inputElement;
    if (type === 'atk') inputElement = document.getElementById('input-atk');
    if (type === 'def') inputElement = document.getElementById('input-def');
    if (type === 'maxHp') inputElement = document.getElementById('input-maxhp');
    if (type === 'hp') inputElement = document.getElementById('input-hp');
    if (type === 'corruption') inputElement = document.getElementById('input-corruption');
    
    if (inputElement) {
      animateInput(inputElement);
    }
  }
  
  // ç«‹å³æ›´æ–°è¡€é‡è¿›åº¦æ¡ï¼ˆåœ¨updateUIä¹‹å‰ï¼‰
  if (type === 'hp' || type === 'maxHp') {
    const hpPercentage = lili.maxHp > 0 ? (lili.hp / lili.maxHp) * 100 : 0;
    document.getElementById('hp-bar').style.width = hpPercentage + '%';
    document.getElementById('hp-display').textContent = lili.hp;
    document.getElementById('maxhp-display').textContent = lili.maxHp;
  }
  
  updateUI();
}

function adjustStat(type, amount) {
  let inputElement;
  if (type === 'atk') inputElement = document.getElementById('input-atk');
  if (type === 'def') inputElement = document.getElementById('input-def');
  if (type === 'maxHp') inputElement = document.getElementById('input-maxhp');
  if (type === 'hp') inputElement = document.getElementById('input-hp');
  
  if (inputElement) {
    const currentValue = parseInt(inputElement.value) || 0;
    let newValue = currentValue + amount;
    
    // è®¾ç½®æœ€å°å€¼é™åˆ¶
    if (type === 'atk') newValue = Math.max(1, newValue);
    if (type === 'def') newValue = Math.max(0, newValue);
    if (type === 'maxHp') newValue = Math.max(20, newValue);
    if (type === 'hp') newValue = Math.max(1, newValue);
    
    inputElement.value = newValue;
    setStat(type, true); // ä½¿ç”¨åŠ¨ç”»æ•ˆæœ
  }
}

function adjustMaxHp(amount) {
  const maxHpInput = document.getElementById('input-maxhp');
  const currentValue = parseInt(maxHpInput.value) || 20;
  const newValue = Math.max(20, currentValue + amount);
  
  maxHpInput.value = newValue;
  setStat('maxHp', true); // ä½¿ç”¨åŠ¨ç”»æ•ˆæœï¼ŒåŒæ—¶ä¿®æ”¹æœ€å¤§è¡€é‡å’Œå½“å‰è¡€é‡
}

function adjustMaxHpOnly(amount) {
  const maxHpInput = document.getElementById('input-maxhp');
  const hpInput = document.getElementById('input-hp');
  const currentMaxHp = parseInt(maxHpInput.value) || 20;
  const newMaxHp = Math.max(20, currentMaxHp + amount);
  
  // åªä¿®æ”¹æœ€å¤§è¡€é‡ï¼Œä¸å½±å“å½“å‰è¡€é‡
  const oldMaxHp = lili.maxHp;
  lili.maxHp = newMaxHp;
  
  // ç¡®ä¿å½“å‰è¡€é‡ä¸è¶…è¿‡æ–°çš„æœ€å¤§è¡€é‡
  if (lili.hp > lili.maxHp) {
    lili.hp = lili.maxHp;
    hpInput.value = lili.hp;
    animateInput(hpInput);
  }
  
  maxHpInput.value = newMaxHp;
  animateInput(maxHpInput);
  
  updateUI();
}

function animateStatChange(element) {
  // ç§»é™¤ä¹‹å‰çš„åŠ¨ç”»ç±»
  element.classList.remove('stat-change', 'fade-out');
  
  // å¼ºåˆ¶é‡ç»˜
  element.offsetHeight;
  
  // æ·»åŠ é«˜äº®æ•ˆæœ
  element.classList.add('stat-change');
  
  // å»¶è¿Ÿåå¼€å§‹æ·¡å‡ºåŠ¨ç”»
  setTimeout(() => {
    element.classList.remove('stat-change');
    element.classList.add('fade-out');
  }, 500);
  
  // æ¸…ç†åŠ¨ç”»ç±»
  setTimeout(() => {
    element.classList.remove('fade-out');
  }, 1500);
}

// æ‚¬æµ®çª—æ§åˆ¶å‡½æ•°
function openHelpModal() {
  document.getElementById('helpModal').style.display = 'block';
}

function closeHelpModal() {
  document.getElementById('helpModal').style.display = 'none';
}

// ç‚¹å‡»æ‚¬æµ®çª—å¤–éƒ¨å…³é—­æ‚¬æµ®çª—
window.onclick = function(event) {
  const modal = document.getElementById('helpModal');
  if (event.target === modal) {
    modal.style.display = 'none';
  }
}

function resetGame() {
  lili.atk = 10;
  lili.def = 5;
  lili.maxHp = 100;
  lili.hp = 100;
  lili.pray = 3;
  lili.corruption = 0;
  bossIdx = 0;
  
  // é‡ç½®æ‰€æœ‰å¼ºåŒ–é€‰é¡¹
  document.getElementById('opt-pray-amount').checked = false;
  document.getElementById('opt-pray-amount5').checked = false;
  document.getElementById('opt-pray-amount-10').checked = false;
  document.getElementById('opt-pray-count').checked = false;
  document.getElementById('opt-molili').checked = false;
  document.getElementById('opt-statue').checked = false;
  document.getElementById('opt-glove').checked = false;
  document.getElementById('opt-no-pray').checked = false;
  document.getElementById('opt-boss-atk').checked = false;
  document.getElementById('opt-minion-atk').checked = false;
  document.getElementById('opt-restraint').checked = false;
  document.getElementById('opt-immunity').checked = false;
  document.getElementById('opt-swap-atk-def').checked = false;
  document.getElementById('opt-dragon-claw').checked = false;
  document.getElementById('opt-no-rest').checked = false;
  document.getElementById('opt-corruption-atk').checked = false;
  document.getElementById('opt-corruption-def').checked = false;
  document.getElementById('opt-corruption-hp').checked = false;
  document.getElementById('opt-corrupted-crown').checked = false;
  document.getElementById('opt-bloody-ribbon').checked = false;
  document.getElementById('opt-rainbow-feather').checked = false;
  document.getElementById('opt-earring').checked = false;
  
  // ç›´æ¥è®¾ç½®è¾“å…¥æ¡†çš„å€¼ä¸ºåˆå§‹å€¼
  document.getElementById('input-atk').value = 10;
  document.getElementById('input-def').value = 5;
  document.getElementById('input-maxhp').value = 100;
  document.getElementById('input-hp').value = 100;
  document.getElementById('input-corruption').value = 0;
  
  // è§¦å‘åŠ¨ç”»æ•ˆæœ
  animateInput(document.getElementById('input-atk'));
  animateInput(document.getElementById('input-def'));
  animateInput(document.getElementById('input-maxhp'));
  animateInput(document.getElementById('input-hp'));
  animateInput(document.getElementById('input-corruption'));
  animateInput(document.getElementById('pray-used'));
  
  // æ¸…ç†å…¨å±€å˜é‡
  window.dragonClawDefReduction = 0;
  
  updateUI();
}

function resetStats() {
  const oldHp = lili.hp;
  const oldPrayUsed = lili.prayUsed;
  lili.hp = lili.maxHp;
  lili.prayUsed = 0; // é‡ç½®å·²ä½¿ç”¨ç¥ˆç¥·æ¬¡æ•°
  
  // å¦‚æœè¡€é‡å‘ç”Ÿå˜åŒ–ï¼Œæ˜¾ç¤ºåŠ¨ç”»
  if (oldHp !== lili.hp) animateInput(document.getElementById('input-hp'));
  // å¦‚æœç¥ˆç¥·æ¬¡æ•°å‘ç”Ÿå˜åŒ–ï¼Œæ˜¾ç¤ºåŠ¨ç”»
  if (oldPrayUsed !== lili.prayUsed) {
    animateInput(document.getElementById('pray-used'));
  }
  
  updateUI();
}

function prevBoss() {
  const oldBossIdx = bossIdx;
  bossIdx = (bossIdx + bosses.length - 1) % bosses.length;
  const oldCorruption = lili.corruption;
  
  // æ ¹æ®Bosså˜åŒ–è°ƒæ•´æ±¡ç§½ç­‰çº§
  const bossChange = bossIdx - oldBossIdx;
  let corruptionChange = 0;
  
  // è®¡ç®—æ±¡ç§½ç­‰çº§å˜åŒ–
  if (bossChange > 0) { // å‘å‰åˆ‡æ¢
    for (let i = oldBossIdx; i < bossIdx; i++) {
      if (i < 8) corruptionChange += 5; // boss1-8æ¯ä¸ª5ç‚¹
      if (i === 7) corruptionChange += 1; // boss8é¢å¤–+1ç‚¹
      // boss9,10ä¸å¢åŠ æ±¡ç§½ç­‰çº§
    }
  } else if (bossChange < 0) { // å‘ååˆ‡æ¢
    for (let i = bossIdx; i < oldBossIdx; i++) {
      if (i < 8) corruptionChange -= 5; // boss1-8æ¯ä¸ª-5ç‚¹
      if (i === 7) corruptionChange -= 1; // boss8é¢å¤–-1ç‚¹
      // boss9,10ä¸å‡å°‘æ±¡ç§½ç­‰çº§
    }
  }
  
  lili.corruption = Math.max(0, lili.corruption + corruptionChange);
  
  // å¦‚æœæ±¡ç§½ç­‰çº§å‘ç”Ÿå˜åŒ–ï¼Œæ˜¾ç¤ºåŠ¨ç”»
  if (oldCorruption !== lili.corruption) {
    animateInput(document.getElementById('input-corruption'));
    updateCorruptionEffects(oldCorruption, lili.corruption);
  }
  
  updateUI();
}

function nextBoss() {
  const oldBossIdx = bossIdx;
  bossIdx = (bossIdx + 1) % bosses.length;
  const oldCorruption = lili.corruption;
  
  // æ ¹æ®Bosså˜åŒ–è°ƒæ•´æ±¡ç§½ç­‰çº§
  const bossChange = bossIdx - oldBossIdx;
  let corruptionChange = 0;
  
  // è®¡ç®—æ±¡ç§½ç­‰çº§å˜åŒ–
  if (bossChange > 0) { // å‘å‰åˆ‡æ¢
    for (let i = oldBossIdx; i < bossIdx; i++) {
      if (i < 8) corruptionChange += 5; // boss1-8æ¯ä¸ª5ç‚¹
      if (i === 7) corruptionChange += 1; // boss8é¢å¤–+1ç‚¹
      // boss9,10ä¸å¢åŠ æ±¡ç§½ç­‰çº§
    }
  } else if (bossChange < 0) { // å‘ååˆ‡æ¢
    for (let i = bossIdx; i < oldBossIdx; i++) {
      if (i < 8) corruptionChange -= 5; // boss1-8æ¯ä¸ª-5ç‚¹
      if (i === 7) corruptionChange -= 1; // boss8é¢å¤–-1ç‚¹
      // boss9,10ä¸å‡å°‘æ±¡ç§½ç­‰çº§
    }
  }
  
  lili.corruption = Math.max(0, lili.corruption + corruptionChange);
  
  // å¦‚æœæ±¡ç§½ç­‰çº§å‘ç”Ÿå˜åŒ–ï¼Œæ˜¾ç¤ºåŠ¨ç”»
  if (oldCorruption !== lili.corruption) {
    animateInput(document.getElementById('input-corruption'));
    updateCorruptionEffects(oldCorruption, lili.corruption);
  }
  
  updateUI();
}

function fightMinion() {
  // è¯»å–å¼ºåŒ–é€‰é¡¹
  const optPrayAmount = document.getElementById('opt-pray-amount').checked;
  const optPrayAmount5 = document.getElementById('opt-pray-amount5').checked;
  const optPrayAmountMinus10 = document.getElementById('opt-pray-amount-10').checked;
  const optPrayCount = document.getElementById('opt-pray-count').checked;
  const optEarring = document.getElementById('opt-earring').checked;
  const optMolili = document.getElementById('opt-molili').checked;
  const optStatue = document.getElementById('opt-statue').checked;
  const optGlove = document.getElementById('opt-glove').checked;
  const optNoPray = document.getElementById('opt-no-pray').checked;
  const optMinionAtk = document.getElementById('opt-minion-atk').checked;
  const optRestraint = document.getElementById('opt-restraint').checked;
  const optImmunity = document.getElementById('opt-immunity').checked;

  let atk = parseInt(document.getElementById('input-atk').value)||10;
  let def = parseInt(document.getElementById('input-def').value)||3;
  let maxHp = parseInt(document.getElementById('input-maxhp').value)||100;
  let prayMax = 3;
  let prayAmount = 0.3;
  if (optPrayAmount) prayAmount += 0.1;
  if (optPrayAmount5) prayAmount += 0.05;
  if (optPrayAmountMinus10) prayAmount -= 0.1;
  if (optPrayCount) prayMax += 1;
  if (optEarring) prayMax += 1;
  if (optStatue) prayMax += 1;
  let atkTimes = 1;
  if (optGlove) atkTimes = 2;

  // æ£€æŸ¥å±æ€§æ˜¯å¦å‘ç”Ÿå˜åŒ–å¹¶è§¦å‘åŠ¨ç”»
  const oldAtk = lili.atk;
  const oldDef = lili.def;
  const oldMaxHp = lili.maxHp;
  
  // åªæ›´æ–°å±æ€§ï¼Œä¸é‡ç½®è¡€é‡
  lili.atk = Math.max(1, atk);
  lili.def = Math.max(0, def);
  lili.maxHp = Math.max(20, maxHp);
  
  // å¦‚æœå±æ€§å‘ç”Ÿå˜åŒ–ï¼Œæ˜¾ç¤ºåŠ¨ç”»
  if (oldAtk !== lili.atk) animateInput(document.getElementById('input-atk'));
  if (oldDef !== lili.def) animateInput(document.getElementById('input-def'));
  if (oldMaxHp !== lili.maxHp) animateInput(document.getElementById('input-maxhp'));

  const minion = minions[bossIdx];
  
  // æ£€æŸ¥å°æ€ªæ˜¯å¦ä¸ºå ä½å°æ€ªï¼ˆè¡€é‡ä¸º0è¡¨ç¤ºæ— å°æ€ªï¼‰
  if (minion.hp === 0) {
    document.getElementById('minion-result').innerHTML = '<span style="color:red;">è¯¥Bossæ²¡æœ‰å¯¹åº”çš„å°æ€ª</span>';
    document.getElementById('minion-predict').textContent = '';
    return;
  }
  
  // ä¼ å…¥å½“å‰è¡€é‡å’Œå‰©ä½™ç¥ˆç¥·æ¬¡æ•°
  const startHp = lili.hp;
  const remainingPray = prayMax - lili.prayUsed;
  const result = minionBattleResult({
    atk: lili.atk,
    def: lili.def,
    maxHp: lili.maxHp,
    hp: startHp,
    pray: remainingPray
  }, minion, bossIdx, {prayAmount, prayMax, atkTimes, optMolili, optStatue, optEarring, optNoPray, optMinionAtk, optRestraint, optImmunity});
  
  const oldHp = lili.hp;
  const oldPrayUsed = lili.prayUsed;
  const oldCorruption = lili.corruption;
  lili.hp = Math.max(0, result.finalHp);
  lili.prayUsed += (remainingPray - result.prayRemaining); // å¢åŠ å·²ä½¿ç”¨çš„ç¥ˆç¥·æ¬¡æ•°
  // æŒ‘æˆ˜å°æ€ªåå¢åŠ æ±¡ç§½ç­‰çº§ï¼ˆç¬¬ä¹å…³å°æ€ªä¸å¢åŠ ï¼‰
  if (bossIdx !== 8) { // éç¬¬ä¹å…³å°æ€ª
    lili.corruption += 1;
  }
  
  // å¦‚æœè¡€é‡å‘ç”Ÿå˜åŒ–ï¼Œæ˜¾ç¤ºåŠ¨ç”»
  if (oldHp !== lili.hp) animateInput(document.getElementById('input-hp'));
  // å¦‚æœç¥ˆç¥·æ¬¡æ•°å‘ç”Ÿå˜åŒ–ï¼Œæ˜¾ç¤ºåŠ¨ç”»
  if (oldPrayUsed !== lili.prayUsed) {
    animateInput(document.getElementById('pray-used'));
  }
  // å¦‚æœæ±¡ç§½ç­‰çº§å‘ç”Ÿå˜åŒ–ï¼Œæ˜¾ç¤ºåŠ¨ç”»
  if (oldCorruption !== lili.corruption) {
    animateInput(document.getElementById('input-corruption'));
    updateCorruptionEffects(oldCorruption, lili.corruption);
  }
  
  if (result.win) {
    document.getElementById('minion-result').innerHTML = '<span class="victory-text">èƒœåˆ©ï¼</span>';
  } else {
    document.getElementById('minion-result').innerHTML = '<span class="defeat-text">å¤±è´¥ï¼</span>';
  }
  document.getElementById('input-hp').value = lili.hp;
  // è®¡ç®—ç¥ˆç¥·æ¬¡æ•°ä¸Šé™
  let prayMaxDisplay = 3;
  if (document.getElementById('opt-pray-count').checked) prayMaxDisplay += 1;
  if (document.getElementById('opt-statue').checked) prayMaxDisplay += 1;
  document.getElementById('pray-used').textContent = lili.pray; // æ˜¾ç¤ºå‰©ä½™ç¥ˆç¥·æ¬¡æ•°
  document.getElementById('pray-max').textContent = prayMaxDisplay;
  
  // é‡æ–°é¢„æµ‹æˆ˜æ–—ç»“æœ
  updateUI();
}

function updateBossIndicators() {
  const indicatorsContainer = document.getElementById('boss-indicators');
  indicatorsContainer.innerHTML = '';
  
  // è¯»å–å¼ºåŒ–é€‰é¡¹æ¥è®¡ç®—æ¯ä¸ªBossçš„æˆ˜æ–—ç»“æœ
  const optPrayAmount = document.getElementById('opt-pray-amount').checked;
  const optPrayAmount5 = document.getElementById('opt-pray-amount5').checked;
  const optPrayAmountMinus10 = document.getElementById('opt-pray-amount-10').checked;
  const optPrayCount = document.getElementById('opt-pray-count').checked;
  const optEarring = document.getElementById('opt-earring').checked;
  const optMolili = document.getElementById('opt-molili').checked;
  const optStatue = document.getElementById('opt-statue').checked;
  const optGlove = document.getElementById('opt-glove').checked;
  const optNoPray = document.getElementById('opt-no-pray').checked;
  const optBossAtk = document.getElementById('opt-boss-atk').checked;
  const optMinionAtk = document.getElementById('opt-minion-atk').checked;
  const optRestraint = document.getElementById('opt-restraint').checked;
  const optImmunity = document.getElementById('opt-immunity').checked;
  const optNoRest = document.getElementById('opt-no-rest').checked;

  let prayMax = 3;
  let prayAmount = 0.3;
  if (optPrayAmount) prayAmount += 0.1;
  if (optPrayAmount5) prayAmount += 0.05;
  if (optPrayAmountMinus10) prayAmount -= 0.1;
  if (optPrayCount) prayMax += 1;
  if (optEarring) prayMax += 1;
  if (optStatue) prayMax += 1;
  let atkTimes = optGlove ? 2 : 1;
  
  for (let i = 0; i < bosses.length; i++) {
    const dot = document.createElement('div');
    dot.className = 'boss-dot';
    dot.title = `Boss ${i + 1}`;
    dot.textContent = i + 1; // æ·»åŠ æ•°å­—1-10
    
    // è®¡ç®—å¯¹è¯¥Bossçš„æˆ˜æ–—ç»“æœ
    let result;
    if (i === 9 && !optNoRest) {
      // ç¬¬åä¸ªbosså‰æ— ä¼‘æ¯ï¼šéœ€è¦è¿ç»­æˆ˜æ–—ç¬¬ä¹ä¸ªå’Œç¬¬åä¸ªboss
      // å…ˆæ‰“ç¬¬ä¹ä¸ªboss
      const boss9Result = battleResultForBoss({
        atk: lili.atk,
        def: lili.def,
        maxHp: lili.maxHp,
        hp: lili.maxHp,
        pray: prayMax
      }, bosses[8], 8, {prayAmount, prayMax, atkTimes, optMolili, optStatue, optPrayCount, optEarring, optNoPray, optBossAtk, optMinionAtk, optRestraint, optImmunity});
      
      if (boss9Result.win) {
        // å¦‚æœç¬¬ä¹ä¸ªbossèƒœåˆ©ï¼Œç”¨å‰©ä½™çŠ¶æ€æ‰“ç¬¬åä¸ªboss
        result = battleResultForBoss({
          atk: lili.atk,
          def: lili.def,
          maxHp: lili.maxHp,
          hp: boss9Result.remainingHp,
          pray: boss9Result.remainingPray
        }, bosses[i], i, {prayAmount, prayMax, atkTimes, optMolili, optStatue, optPrayCount, optEarring, optNoPray, optBossAtk, optMinionAtk, optRestraint, optImmunity});
      } else {
        // å¦‚æœç¬¬ä¹ä¸ªbosså¤±è´¥ï¼Œç¬¬åä¸ªbossä¹Ÿç®—å¤±è´¥
        result = { win: false };
      }
    } else {
      // æ­£å¸¸è®¡ç®—
      result = battleResultForBoss({
        atk: lili.atk,
        def: lili.def,
        maxHp: lili.maxHp,
        hp: lili.maxHp, // ç”¨æ»¡è¡€è®¡ç®—
        pray: prayMax // ç”¨æ»¡ç¥ˆç¥·æ¬¡æ•°è®¡ç®—
      }, bosses[i], i, {prayAmount, prayMax, atkTimes, optMolili, optStatue, optPrayCount, optEarring, optNoPray, optBossAtk, optMinionAtk, optRestraint, optImmunity});
    }
    
    // è®¾ç½®é¢œè‰²
    if (result.win) {
      dot.classList.add('victory');
    } else {
      dot.classList.add('defeat');
    }
    
    // è®¾ç½®å½“å‰é€‰ä¸­çŠ¶æ€
    if (i === bossIdx) {
      dot.classList.add('active');
    }
    
    // ç‚¹å‡»åˆ‡æ¢Boss
    dot.addEventListener('click', () => {
      const oldBossIdx = bossIdx;
      bossIdx = i;
      const oldCorruption = lili.corruption;
      
      // æ ¹æ®Bosså˜åŒ–è°ƒæ•´æ±¡ç§½ç­‰çº§
      const bossChange = bossIdx - oldBossIdx;
      let corruptionChange = 0;
      
      // è®¡ç®—æ±¡ç§½ç­‰çº§å˜åŒ–
      if (bossChange > 0) { // å‘å‰åˆ‡æ¢
        for (let j = oldBossIdx; j < bossIdx; j++) {
          if (j < 8) corruptionChange += 5; // boss1-8æ¯ä¸ª5ç‚¹
          if (j === 7) corruptionChange += 1; // boss8é¢å¤–+1ç‚¹
          // boss9,10ä¸å¢åŠ æ±¡ç§½ç­‰çº§
        }
      } else if (bossChange < 0) { // å‘ååˆ‡æ¢
        for (let j = bossIdx; j < oldBossIdx; j++) {
          if (j < 8) corruptionChange -= 5; // boss1-8æ¯ä¸ª-5ç‚¹
          if (j === 7) corruptionChange -= 1; // boss8é¢å¤–-1ç‚¹
          // boss9,10ä¸å‡å°‘æ±¡ç§½ç­‰çº§
        }
      }
      
      lili.corruption = Math.max(0, lili.corruption + corruptionChange);
      
      // å¦‚æœæ±¡ç§½ç­‰çº§å‘ç”Ÿå˜åŒ–ï¼Œæ˜¾ç¤ºåŠ¨ç”»
      if (oldCorruption !== lili.corruption) {
        animateInput(document.getElementById('input-corruption'));
        updateCorruptionEffects(oldCorruption, lili.corruption);
      }
      
      updateUI();
    });
    
    indicatorsContainer.appendChild(dot);
  }
}

function toggleSwapAtkDef() {
  const isChecked = document.getElementById('opt-swap-atk-def').checked;
  
  if (isChecked) {
    // é€‰ä¸­æ—¶ï¼šäº¤æ¢æ”»å‡»å’Œé˜²å¾¡ï¼Œç„¶åå„è‡ª+2
    const tempAtk = lili.atk;
    lili.atk = lili.def + 2;
    lili.def = tempAtk + 2;
  } else {
    // å–æ¶ˆæ—¶ï¼šå…ˆå„è‡ª-2ï¼Œç„¶åäº¤æ¢å›å»
    const tempAtk = Math.max(1, lili.atk - 2);
    const tempDef = Math.max(0, lili.def - 2);
    lili.atk = tempDef;
    lili.def = tempAtk;
  }
  
  // æ›´æ–°è¾“å…¥æ¡†çš„å€¼
  document.getElementById('input-atk').value = lili.atk;
  document.getElementById('input-def').value = lili.def;
  
  // æ˜¾ç¤ºåŠ¨ç”»
  animateInput(document.getElementById('input-atk'));
  animateInput(document.getElementById('input-def'));
  
  updateUI();
}

function toggleGlove() {
  const isChecked = document.getElementById('opt-glove').checked;
  
  if (isChecked) {
    // é€‰ä¸­æ—¶æ”»å‡»åŠ›-5
    lili.atk = Math.max(1, lili.atk - 5);
  } else {
    // å–æ¶ˆæ—¶æ”»å‡»åŠ›+5
    lili.atk += 5;
  }
  
  // æ›´æ–°è¾“å…¥æ¡†çš„å€¼
  document.getElementById('input-atk').value = lili.atk;
  
  // æ˜¾ç¤ºåŠ¨ç”»
  animateInput(document.getElementById('input-atk'));
  
  updateUI();
}

function togglePrayDefense() {
  const isChecked = document.getElementById('opt-pray-amount-10').checked;
  
  if (isChecked) {
    // é€‰ä¸­æ—¶é˜²å¾¡åŠ›+4
    lili.def += 4;
  } else {
    // å–æ¶ˆæ—¶é˜²å¾¡åŠ›-4
    lili.def = Math.max(0, lili.def - 4);
  }
  
  // æ›´æ–°è¾“å…¥æ¡†çš„å€¼
  document.getElementById('input-def').value = lili.def;
  
  // æ˜¾ç¤ºåŠ¨ç”»
  animateInput(document.getElementById('input-def'));
  
  updateUI();
}

function toggleImmunityDefense() {
  const isChecked = document.getElementById('opt-immunity').checked;
  
  if (isChecked) {
    // é€‰ä¸­æ—¶é˜²å¾¡åŠ›+3
    lili.def += 3;
  } else {
    // å–æ¶ˆæ—¶é˜²å¾¡åŠ›-3
    lili.def = Math.max(0, lili.def - 3);
  }
  
  // æ›´æ–°è¾“å…¥æ¡†çš„å€¼
  document.getElementById('input-def').value = lili.def;
  
  // æ˜¾ç¤ºåŠ¨ç”»
  animateInput(document.getElementById('input-def'));
  
  updateUI();
}

function toggleMagicChain() {
  const isChecked = document.getElementById('opt-restraint').checked;
  
  if (isChecked) {
    // é€‰ä¸­æ—¶é˜²å¾¡åŠ›+1
    lili.def += 1;
  } else {
    // å–æ¶ˆæ—¶é˜²å¾¡åŠ›-1
    lili.def = Math.max(0, lili.def - 1);
  }
  
  // æ›´æ–°è¾“å…¥æ¡†çš„å€¼
  document.getElementById('input-def').value = lili.def;
  
  // æ˜¾ç¤ºåŠ¨ç”»
  animateInput(document.getElementById('input-def'));
  
  updateUI();
}

function toggleMoliliRing() {
  const isChecked = document.getElementById('opt-molili').checked;
  
  if (isChecked) {
    // é€‰ä¸­æ—¶é˜²å¾¡åŠ›+3
    lili.def += 3;
  } else {
    // å–æ¶ˆæ—¶é˜²å¾¡åŠ›-3
    lili.def = Math.max(0, lili.def - 3);
  }
  
  // æ›´æ–°è¾“å…¥æ¡†çš„å€¼
  document.getElementById('input-def').value = lili.def;
  
  // æ˜¾ç¤ºåŠ¨ç”»
  animateInput(document.getElementById('input-def'));
  
  updateUI();
}

function toggleDragonClaw() {
  const isChecked = document.getElementById('opt-dragon-claw').checked;
  
  if (isChecked) {
    // é€‰ä¸­æ—¶ï¼šå‡å°‘50%é˜²å¾¡å¹¶å¢åŠ ä¸¤å€å‡å°‘çš„å€¼åˆ°æ”»å‡»åŠ›
    const defReduction = Math.floor(lili.def * 0.5);
    lili.def -= defReduction;
    lili.atk += defReduction * 2;
    
    // å°†åŸå§‹å‡å°‘å€¼å­˜å‚¨åœ¨å…¨å±€å˜é‡ä¸­ä»¥ä¾¿æ¢å¤
    window.dragonClawDefReduction = defReduction;
  } else {
    // å–æ¶ˆæ—¶ï¼šæ¢å¤åŸå§‹å€¼
    const defReduction = window.dragonClawDefReduction || 0;
    lili.def += defReduction;
    lili.atk -= defReduction * 2;
    
    // æ¸…ç†å…¨å±€å˜é‡
    window.dragonClawDefReduction = 0;
  }
  
  // æ›´æ–°è¾“å…¥æ¡†çš„å€¼
  document.getElementById('input-atk').value = lili.atk;
  document.getElementById('input-def').value = lili.def;
  
  // æ˜¾ç¤ºåŠ¨ç”»
  animateInput(document.getElementById('input-atk'));
  animateInput(document.getElementById('input-def'));
  
  updateUI();
}

function toggleCorruptedCrown() {
  const isChecked = document.getElementById('opt-corrupted-crown').checked;
  
  if (isChecked) {
    // é€‰ä¸­æ—¶ï¼šæ”»å‡»+4ï¼Œé˜²å¾¡+4
    lili.atk += 4;
    lili.def += 4;
  } else {
    // å–æ¶ˆæ—¶ï¼šæ”»å‡»-4ï¼Œé˜²å¾¡-4
    lili.atk = Math.max(0, lili.atk - 4);
    lili.def = Math.max(0, lili.def - 4);
  }
  
  // æ›´æ–°è¾“å…¥æ¡†çš„å€¼
  document.getElementById('input-atk').value = lili.atk;
  document.getElementById('input-def').value = lili.def;
  
  // æ˜¾ç¤ºåŠ¨ç”»
  animateInput(document.getElementById('input-atk'));
  animateInput(document.getElementById('input-def'));
  
  updateUI();
}

function toggleBloodyRibbon() {
  const isChecked = document.getElementById('opt-bloody-ribbon').checked;
  
  if (isChecked) {
    // é€‰ä¸­æ—¶ï¼šæ”»å‡»+4ï¼Œç”Ÿå‘½ä¸Šé™-20
    lili.atk += 4;
    lili.maxHp = Math.max(1, lili.maxHp - 20);
    // å¦‚æœå½“å‰è¡€é‡è¶…è¿‡æ–°çš„æœ€å¤§å€¼ï¼Œè°ƒæ•´å½“å‰è¡€é‡
    if (lili.hp > lili.maxHp) {
      lili.hp = lili.maxHp;
    }
  } else {
    // å–æ¶ˆæ—¶ï¼šæ”»å‡»-4ï¼Œç”Ÿå‘½ä¸Šé™+20
    lili.atk = Math.max(0, lili.atk - 4);
    lili.maxHp += 20;
  }
  
  // æ›´æ–°è¾“å…¥æ¡†çš„å€¼
  document.getElementById('input-atk').value = lili.atk;
  document.getElementById('input-maxhp').value = lili.maxHp;
  document.getElementById('input-hp').value = lili.hp;
  
  // æ˜¾ç¤ºåŠ¨ç”»
  animateInput(document.getElementById('input-atk'));
  animateInput(document.getElementById('input-maxhp'));
  animateInput(document.getElementById('input-hp'));
  
  updateUI();
}

function toggleRainbowFeather() {
  const isChecked = document.getElementById('opt-rainbow-feather').checked;
  
  if (isChecked) {
    // é€‰ä¸­æ—¶ï¼šæ”»å‡»+2ï¼Œé˜²å¾¡+2ï¼Œç”Ÿå‘½ä¸Šé™+40
    lili.atk += 2;
    lili.def += 2;
    lili.maxHp += 40;
  } else {
    // å–æ¶ˆæ—¶ï¼šæ”»å‡»-2ï¼Œé˜²å¾¡-2ï¼Œç”Ÿå‘½ä¸Šé™-40
    lili.atk = Math.max(0, lili.atk - 2);
    lili.def = Math.max(0, lili.def - 2);
    lili.maxHp = Math.max(1, lili.maxHp - 40);
    // å¦‚æœå½“å‰è¡€é‡è¶…è¿‡æ–°çš„æœ€å¤§å€¼ï¼Œè°ƒæ•´å½“å‰è¡€é‡
    if (lili.hp > lili.maxHp) {
      lili.hp = lili.maxHp;
    }
  }
  
  // æ›´æ–°è¾“å…¥æ¡†çš„å€¼
  document.getElementById('input-atk').value = lili.atk;
  document.getElementById('input-def').value = lili.def;
  document.getElementById('input-maxhp').value = lili.maxHp;
  document.getElementById('input-hp').value = lili.hp;
  
  // æ˜¾ç¤ºåŠ¨ç”»
  animateInput(document.getElementById('input-atk'));
  animateInput(document.getElementById('input-def'));
  animateInput(document.getElementById('input-maxhp'));
  animateInput(document.getElementById('input-hp'));
  
  updateUI();
}

function toggleCorruptionAtk() {
  const isChecked = document.getElementById('opt-corruption-atk').checked;
  const corruption = lili.corruption;
  const atkBonus = Math.floor(corruption * 0.1);
  
  if (isChecked) {
    lili.atk += atkBonus;
  } else {
    lili.atk -= atkBonus;
  }
  
  // æ›´æ–°è¾“å…¥æ¡†çš„å€¼
  document.getElementById('input-atk').value = lili.atk;
  
  // æ˜¾ç¤ºåŠ¨ç”»
  animateInput(document.getElementById('input-atk'));
  
  updateUI();
}

function toggleCorruptionDef() {
  const isChecked = document.getElementById('opt-corruption-def').checked;
  const corruption = lili.corruption;
  const defBonus = Math.floor(corruption * 0.1);
  
  if (isChecked) {
    lili.def += defBonus;
  } else {
    lili.def -= defBonus;
  }
  
  // æ›´æ–°è¾“å…¥æ¡†çš„å€¼
  document.getElementById('input-def').value = lili.def;
  
  // æ˜¾ç¤ºåŠ¨ç”»
  animateInput(document.getElementById('input-def'));
  
  updateUI();
}

function toggleCorruptionHp() {
  const isChecked = document.getElementById('opt-corruption-hp').checked;
  const corruption = lili.corruption;
  const hpBonus = Math.floor(corruption * 1);
  
  if (isChecked) {
    lili.maxHp += hpBonus;
    // ä¸åŒæ­¥ä¿®æ”¹å½“å‰è¡€é‡ï¼Œåªä¿®æ”¹æœ€å¤§è¡€é‡
  } else {
    lili.maxHp -= hpBonus;
    // ç¡®ä¿å½“å‰è¡€é‡ä¸è¶…è¿‡æ–°çš„æœ€å¤§è¡€é‡
    if (lili.hp > lili.maxHp) {
      lili.hp = lili.maxHp;
    }
  }
  
  // æ›´æ–°è¾“å…¥æ¡†çš„å€¼
  document.getElementById('input-maxhp').value = lili.maxHp;
  document.getElementById('input-hp').value = lili.hp;
  
  // æ˜¾ç¤ºåŠ¨ç”»
  animateInput(document.getElementById('input-maxhp'));
  // åªæœ‰å½“å‰è¡€é‡è¢«è°ƒæ•´æ—¶æ‰æ˜¾ç¤ºåŠ¨ç”»
  if (!isChecked && lili.hp > lili.maxHp) {
    animateInput(document.getElementById('input-hp'));
  }
  
  updateUI();
}

function updateCorruptionEffects(oldCorruption, newCorruption) {
  // è®¡ç®—æ—§çš„å’Œæ–°çš„åŠ æˆå€¼
  const oldAtkBonus = Math.floor(oldCorruption * 0.1);
  const newAtkBonus = Math.floor(newCorruption * 0.1);
  const oldDefBonus = Math.floor(oldCorruption * 0.1);
  const newDefBonus = Math.floor(newCorruption * 0.1);
  const oldHpBonus = Math.floor(oldCorruption * 1);
  const newHpBonus = Math.floor(newCorruption * 1);
  
  // æ£€æŸ¥å„ä¸ªæ±¡ç§½è£…å¤‡æ˜¯å¦è¢«å‹¾é€‰ï¼Œå¦‚æœå‹¾é€‰åˆ™æ›´æ–°å±æ€§
  const optCorruptionAtk = document.getElementById('opt-corruption-atk').checked;
  const optCorruptionDef = document.getElementById('opt-corruption-def').checked;
  const optCorruptionHp = document.getElementById('opt-corruption-hp').checked;
  
  if (optCorruptionAtk) {
    // å…ˆå‡å»æ—§çš„åŠ æˆï¼Œå†åŠ ä¸Šæ–°çš„åŠ æˆ
    lili.atk = lili.atk - oldAtkBonus + newAtkBonus;
    document.getElementById('input-atk').value = lili.atk;
    animateInput(document.getElementById('input-atk'));
  }
  
  if (optCorruptionDef) {
    lili.def = lili.def - oldDefBonus + newDefBonus;
    document.getElementById('input-def').value = lili.def;
    animateInput(document.getElementById('input-def'));
  }
  
  if (optCorruptionHp) {
    const hpDiff = newHpBonus - oldHpBonus;
    lili.maxHp += hpDiff;
    // ä¸åŒæ­¥è°ƒæ•´å½“å‰è¡€é‡ï¼Œåªä¿®æ”¹æœ€å¤§è¡€é‡
    // ç¡®ä¿å½“å‰è¡€é‡ä¸è¶…è¿‡æ–°çš„æœ€å¤§è¡€é‡
    if (lili.hp > lili.maxHp) {
      lili.hp = lili.maxHp;
    }
    
    document.getElementById('input-maxhp').value = lili.maxHp;
    document.getElementById('input-hp').value = lili.hp;
    animateInput(document.getElementById('input-maxhp'));
    // åªæœ‰å½“å‰è¡€é‡è¢«è°ƒæ•´æ—¶æ‰æ˜¾ç¤ºåŠ¨ç”»
    if (lili.hp > lili.maxHp) {
      animateInput(document.getElementById('input-hp'));
    }
  }
}

function calculatePointSuggestion(boss, bossIdx, options) {
  // åŸºç¡€æ»¡è¡€æ»¡ç¥ˆç¥·çš„è‰è‰å±æ€§
  const baseLili = {
    atk: lili.atk,
    def: lili.def,
    maxHp: lili.maxHp,
    hp: lili.maxHp, // æ»¡è¡€
    pray: options.prayMax // æ»¡ç¥ˆç¥·
  };
  
  // å¦‚æœæ»¡è¡€æ»¡ç¥ˆç¥·è¿˜æ˜¯å¤±è´¥ï¼Œåˆ™è®¡ç®—åŠ ç‚¹å»ºè®®
  let baseResult;
  if (bossIdx === 9 && !options.optNoRest) {
    // ç¬¬åä¸ªbosså‰æ— ä¼‘æ¯ï¼šéœ€è¦è¿ç»­æˆ˜æ–—ç¬¬ä¹ä¸ªå’Œç¬¬åä¸ªboss
    const boss9Result = battleResultForBoss(baseLili, bosses[8], 8, options);
    if (boss9Result.win) {
      baseResult = battleResultForBoss({
        atk: baseLili.atk,
        def: baseLili.def,
        maxHp: baseLili.maxHp,
        hp: boss9Result.remainingHp,
        pray: boss9Result.remainingPray
      }, boss, bossIdx, options);
    } else {
      baseResult = { win: false };
    }
  } else {
    baseResult = battleResultForBoss(baseLili, boss, bossIdx, options);
  }
  
  if (baseResult.win) {
    return null; // æ»¡è¡€æ»¡ç¥ˆç¥·å¯ä»¥èƒœåˆ©ï¼Œä¸éœ€è¦å»ºè®®
  }
  
  // å°è¯•æ‰€æœ‰å¯èƒ½çš„åŠ ç‚¹ç»„åˆï¼Œæ€»ç‚¹æ•°ä¸è¶…è¿‡50ï¼Œä¼˜å…ˆçº§ï¼šæ”»å‡»>è¡€é‡>é˜²å¾¡
  for (let totalPoints = 1; totalPoints <= 50; totalPoints++) {
    // æŒ‰ç…§æ€»ç‚¹æ•°é€’å¢é¡ºåºæœç´¢ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªè§£å°±æ˜¯æœ€ä¼˜è§£
    // ä¼˜å…ˆåŠ æ”»å‡»ï¼Œæ‰€ä»¥ä»æœ€å°‘é˜²å¾¡å¼€å§‹
    for (let defPoints = 0; defPoints <= totalPoints; defPoints++) {
      const remainingAfterDef = totalPoints - defPoints;
      for (let hpPointsActual = 0; hpPointsActual <= remainingAfterDef; hpPointsActual++) {
        const atkPoints = remainingAfterDef - hpPointsActual;
        const hpPoints = hpPointsActual * 20; // æ¯ç‚¹è¡€é‡å®é™…å¢åŠ 20
        
        const testLili = {
          atk: baseLili.atk + atkPoints,
          def: baseLili.def + defPoints,
          maxHp: baseLili.maxHp + hpPoints,
          hp: baseLili.maxHp + hpPoints, // æ»¡è¡€
          pray: baseLili.pray
        };
        
        let testResult;
        if (bossIdx === 9 && !options.optNoRest) {
          // ç¬¬åä¸ªbosså‰æ— ä¼‘æ¯ï¼šæµ‹è¯•è¿ç»­æˆ˜æ–—
          const boss9TestResult = battleResultForBoss(testLili, bosses[8], 8, options);
          if (boss9TestResult.win) {
            testResult = battleResultForBoss({
              atk: testLili.atk,
              def: testLili.def,
              maxHp: testLili.maxHp,
              hp: boss9TestResult.remainingHp,
              pray: boss9TestResult.remainingPray
            }, boss, bossIdx, options);
          } else {
            testResult = { win: false };
          }
        } else {
          testResult = battleResultForBoss(testLili, boss, bossIdx, options);
        }
        
        if (testResult.win) {
          return `ATK:${atkPoints}, DEF:${defPoints}, HP:${hpPointsActual}`;
        }
      }
    }
  }
  
  return "50ç‚¹å†…åŠ ç‚¹æ— è§£";
}

function updateUI() {
  // è¯»å–å¼ºåŒ–é€‰é¡¹
  const optPrayAmount = document.getElementById('opt-pray-amount').checked;
  const optPrayAmount5 = document.getElementById('opt-pray-amount5').checked;
  const optPrayAmountMinus10 = document.getElementById('opt-pray-amount-10').checked;
  const optPrayCount = document.getElementById('opt-pray-count').checked;
  const optEarring = document.getElementById('opt-earring').checked;
  const optMolili = document.getElementById('opt-molili').checked;
  const optStatue = document.getElementById('opt-statue').checked;
  const optGlove = document.getElementById('opt-glove').checked;
  const optNoPray = document.getElementById('opt-no-pray').checked;
  const optBossAtk = document.getElementById('opt-boss-atk').checked;
  const optMinionAtk = document.getElementById('opt-minion-atk').checked;
  const optRestraint = document.getElementById('opt-restraint').checked;
  const optImmunity = document.getElementById('opt-immunity').checked;
  const optNoRest = document.getElementById('opt-no-rest').checked;
  const optCorruptionAtk = document.getElementById('opt-corruption-atk').checked;
  const optCorruptionDef = document.getElementById('opt-corruption-def').checked;
  const optCorruptionHp = document.getElementById('opt-corruption-hp').checked;

  // åŸºç¡€å±æ€§
  let atk = parseInt(document.getElementById('input-atk').value)||10;
  let def = parseInt(document.getElementById('input-def').value)||3;
  let maxHp = parseInt(document.getElementById('input-maxhp').value)||100;
  let prayMax = 3;
  let prayAmount = 0.3; // ç¥ˆç¥·æ¢å¤æ¯”ä¾‹
  if (optPrayAmount) prayAmount += 0.1;
  if (optPrayAmount5) prayAmount += 0.05;
  if (optPrayAmountMinus10) prayAmount -= 0.1;
  if (optPrayCount) prayMax += 1;
  if (optEarring) prayMax += 1;
  if (optStatue) prayMax += 1;
  let atkTimes = 1;
  if (optGlove) { atkTimes = 2; }
  
  // åªæ›´æ–°å±æ€§ï¼Œä¸é‡ç½®è¡€é‡å’Œç¥ˆç¥·æ¬¡æ•°
  lili.atk = Math.max(1, atk);
  lili.def = Math.max(0, def);
  lili.maxHp = Math.max(20, maxHp);
  // ä¿æŒå½“å‰ç¥ˆç¥·æ¬¡æ•°ä¸å˜ï¼Œä¸é‡æ–°è®¡ç®—
  // lili.pray ä¿æŒä¸å˜

  // è®¡ç®—ç¥ˆç¥·æ¬¡æ•°ä¸Šé™å¹¶æ˜¾ç¤ºå‰©ä½™/ä¸Šé™
  const currentRemainingPray = prayMax - lili.prayUsed;
  document.getElementById('pray-used').textContent = currentRemainingPray; // æ˜¾ç¤ºå‰©ä½™ç¥ˆç¥·æ¬¡æ•°
  document.getElementById('pray-max').textContent = prayMax;
  
  // æ›´æ–°ç¥ˆç¥·è¿›åº¦æ¡
  const prayPercentage = prayMax > 0 ? (currentRemainingPray / prayMax) * 100 : 0;
  document.getElementById('pray-bar').style.width = prayPercentage + '%';
  
  // æ›´æ–°è¡€é‡è¿›åº¦æ¡
  const hpPercentage = lili.maxHp > 0 ? (lili.hp / lili.maxHp) * 100 : 0;
  document.getElementById('hp-bar').style.width = hpPercentage + '%';
  document.getElementById('hp-display').textContent = lili.hp;
  document.getElementById('maxhp-display').textContent = lili.maxHp;
  
  document.getElementById('input-atk').value = lili.atk;
  document.getElementById('input-def').value = lili.def;
  document.getElementById('input-maxhp').value = lili.maxHp;
  document.getElementById('input-hp').value = lili.hp;
  document.getElementById('input-corruption').value = lili.corruption;
  
  // æ˜¾ç¤ºæ”»å‡»åŠ›åŠ æˆï¼ˆç¬¬ä¹å’Œç¬¬åbossæ—¶ï¼‰
  const atkBonusElement = document.getElementById('atk-bonus');
  if (bossIdx === 8 || bossIdx === 9) {
    atkBonusElement.textContent = '+7';
  } else {
    atkBonusElement.textContent = '';
  }
  
  // è®¡ç®—å‰©ä½™å¯å¢åŠ æ±¡ç§½ç­‰çº§ï¼ˆåªåœ¨ç¬¬ä¹å…³å‰æ˜¾ç¤ºï¼‰
  const remainingCorruptionElement = document.getElementById('remaining-corruption');
  const remainingCorruptionValue = document.getElementById('remaining-corruption-value');
  
  if (bossIdx < 9) { // ç¬¬åå…³æ˜¯bossIdx=9
    const currentCorruption = lili.corruption;
    const maxAllowedCorruption = 60; // ä¿®æ­£æœ€å¤§æ±¡ç§½ç­‰çº§
    
    // è®¡ç®—ä»å½“å‰Bossåˆ‡æ¢åˆ°ç¬¬åå…³è¿˜éœ€è¦å¢åŠ å¤šå°‘ç‚¹æ±¡ç§½ç­‰çº§
    let requiredCorruption = 0;
    for (let i = bossIdx; i < 9; i++) {
      if (i < 8) requiredCorruption += 5; // boss1-8æ¯ä¸ª5ç‚¹
      if (i === 7) requiredCorruption += 1; // boss8é¢å¤–+1ç‚¹
      // boss9,10ä¸å¢åŠ æ±¡ç§½ç­‰çº§
    }
    
    const remainingCorruption = Math.max(0, maxAllowedCorruption - currentCorruption - requiredCorruption);
    remainingCorruptionValue.textContent = remainingCorruption;
    
    // æ ¹æ®å‰©ä½™æ±¡ç§½ç­‰çº§è®¾ç½®é¢œè‰²
    if (remainingCorruption === 0) {
      remainingCorruptionValue.style.backgroundColor = '#e74c3c'; // çº¢è‰²
      remainingCorruptionValue.style.color = 'white';
    } else if (remainingCorruption <= 1) {
      remainingCorruptionValue.style.backgroundColor = '#e67e22'; // æ©™è‰²
      remainingCorruptionValue.style.color = 'white';
    } else if (remainingCorruption <= 3) {
      remainingCorruptionValue.style.backgroundColor = '#f1c40f'; // é»„è‰²
      remainingCorruptionValue.style.color = 'black';
    } else {
      remainingCorruptionValue.style.backgroundColor = 'transparent';
      remainingCorruptionValue.style.color = 'inherit';
    }
    remainingCorruptionValue.style.padding = '2px 4px';
    remainingCorruptionValue.style.borderRadius = '3px';
    
    remainingCorruptionElement.style.display = 'block';
  } else {
    remainingCorruptionElement.style.display = 'none';
  }
  
  const boss = bosses[bossIdx];
  const minion = minions[bossIdx];
  document.getElementById('boss-num').textContent = bossIdx + 1;
  document.getElementById('boss-atk').textContent = boss.atk;
  document.getElementById('boss-def').textContent = boss.def;
  document.getElementById('boss-hp').textContent = boss.hp;
  document.getElementById('boss-special').textContent = boss.special;
  document.getElementById('minion-atk').textContent = minion.atk;
  document.getElementById('minion-def').textContent = minion.def;
  document.getElementById('minion-hp').textContent = minion.hp;
  document.getElementById('minion-special').textContent = minion.special;
  document.getElementById('boss-img').textContent = bossIdx + 1;
  
  // æˆ˜æ–—é¢„æµ‹ç”¨å½“å‰è¡€é‡å’Œç¥ˆç¥·æ¬¡æ•°
  const remainingPray = prayMax - lili.prayUsed;
  const result = battleResultForBoss({
    atk: lili.atk,
    def: lili.def,
    maxHp: lili.maxHp,
    hp: lili.hp,
    pray: remainingPray
  }, boss, bossIdx, {prayAmount, prayMax, atkTimes, optMolili, optStatue, optPrayCount, optEarring, optNoPray, optBossAtk, optMinionAtk, optRestraint, optImmunity});
  
  if (result.win) {
    document.getElementById('battle-result').innerHTML = '<span class="victory-text">èƒœåˆ©ï¼</span>';
    // å¯¹äºç¬¬åä¸ªbossï¼Œå³ä½¿èƒœåˆ©ä¹Ÿè¦æ˜¾ç¤ºåŠ ç‚¹å»ºè®®ï¼ˆè€ƒè™‘æ— ä¼‘æ¯æƒ…å†µï¼‰
    if (bossIdx === 9) {
      const suggestion = calculatePointSuggestion(boss, bossIdx, {prayAmount, prayMax, atkTimes, optMolili, optStatue, optPrayCount, optEarring, optNoPray, optBossAtk, optMinionAtk, optRestraint, optImmunity, optNoRest});
      if (suggestion) {
        document.getElementById('suggestion-text').textContent = suggestion;
        document.getElementById('point-suggestion').style.display = 'block';
      } else {
        document.getElementById('point-suggestion').style.display = 'none';
      }
    } else {
      // å…¶ä»–bossèƒœåˆ©æ—¶éšè—åŠ ç‚¹å»ºè®®
      document.getElementById('point-suggestion').style.display = 'none';
    }
  } else {
    document.getElementById('battle-result').innerHTML = '<span class="defeat-text">å¤±è´¥ï¼</span>';
    // è®¡ç®—åŠ ç‚¹å»ºè®®
    const suggestion = calculatePointSuggestion(boss, bossIdx, {prayAmount, prayMax, atkTimes, optMolili, optStatue, optPrayCount, optEarring, optNoPray, optBossAtk, optMinionAtk, optRestraint, optImmunity, optNoRest});
    if (suggestion) {
      document.getElementById('suggestion-text').textContent = suggestion;
      document.getElementById('point-suggestion').style.display = 'block';
    } else {
      document.getElementById('point-suggestion').style.display = 'none';
    }
  }
  const hpChange = result.remainingHp - lili.hp; // æ­£å€¼è¡¨ç¤ºæ¢å¤ï¼Œè´Ÿå€¼è¡¨ç¤ºæŸå¤±
  const hpChangeText = hpChange >= 0 ? `+${hpChange}` : `${hpChange}`;
  document.getElementById('hp-consumed').innerHTML = `è¡€é‡å˜åŒ–ï¼š${hpChangeText}<br>å‰©ä½™è¡€é‡ï¼š${result.remainingHp}<br>å‰©ä½™ç¥ˆç¥·æ¬¡æ•°ï¼š${result.remainingPray}`;
  document.getElementById('damage-log').textContent = result.damageLog.join('\n');
  
  // è‡ªåŠ¨æ›´æ–°å°æ€ªé¢„æµ‹ï¼ˆç”¨å½“å‰è¡€é‡å’Œç¥ˆç¥·æ¬¡æ•°ï¼‰
  if (minion.hp > 0) {
    const minionResult = minionBattleResult({
      atk: lili.atk,
      def: lili.def,
      maxHp: lili.maxHp,
      hp: lili.hp,
      pray: remainingPray
    }, minion, bossIdx, {prayAmount, prayMax, atkTimes, optMolili, optStatue, optEarring, optNoPray, optMinionAtk, optRestraint, optImmunity});
    if (minionResult.win) {
      const hpConsumed = Math.max(0, lili.hp - minionResult.finalHp);
      // å®‰å…¨å‡»æ€æ•°ç”¨bossæˆ˜æ–—åçš„å‰©ä½™è¡€é‡è®¡ç®—ï¼š(bossæˆ˜åå‰©ä½™è¡€é‡-1) / æ¯åªå°æ€ªæ¶ˆè€—è¡€é‡
      const safeKillCount = hpConsumed > 0 ? Math.floor((result.remainingHp - 1) / hpConsumed) : Infinity;
      // å¦‚æœbossæˆ˜æ–—åæœ‰å‰©ä½™ç¥ˆç¥·æ¬¡æ•°ï¼Œåœ¨å®‰å…¨å‡»æ€æ•°åæ·»åŠ +å·
      const plusSign = result.remainingPray > 0 ? '+' : '';
      const safeKillDisplay = safeKillCount < 1 ? '<span class="defeat-text">' + (safeKillCount === Infinity ? 'âˆ' : safeKillCount) + plusSign + '</span>' : (safeKillCount === Infinity ? 'âˆ' : safeKillCount) + plusSign;
      document.getElementById('minion-predict').innerHTML = '<span class="victory-text">é¢„æµ‹ï¼šèƒœåˆ©</span><br>æ¶ˆè€—è¡€é‡ï¼š' + hpConsumed + '<br>å‰©ä½™å®‰å…¨å‡»æ€æ•°ï¼š' + safeKillDisplay;
    } else {
      document.getElementById('minion-predict').innerHTML = '<span class="defeat-text">é¢„æµ‹ï¼šå¤±è´¥</span>';
    }
  } else {
    document.getElementById('minion-predict').textContent = '';
  }
  
  // æ›´æ–°BossæŒ‡ç¤ºå™¨
  updateBossIndicators();
}

// è°ƒè¯•é¢æ¿çŠ¶æ€
let debugOffset = {
  bossAtk: 0,
  bossDef: 0,
  bossHp: 0,
  minionAtk: 0,
  minionDef: 0,
  minionHp: 0
};

// è·å–è°ƒè¯•åçš„bosså±æ€§
function getDebuggedBoss(boss) {
  return {
    ...boss,
    atk: boss.atk + (debugOffset.bossAtk || 0),
    def: boss.def + (debugOffset.bossDef || 0),
    hp: boss.hp + (debugOffset.bossHp || 0)
  };
}

// è·å–è°ƒè¯•åçš„å°æ€ªå±æ€§
function getDebuggedMinion(minion) {
  return {
    ...minion,
    atk: minion.atk + (debugOffset.minionAtk || 0),
    def: minion.def + (debugOffset.minionDef || 0),
    hp: minion.hp + (debugOffset.minionHp || 0)
  };
}

// åˆ‡æ¢è°ƒè¯•é¢æ¿æ˜¾ç¤ºçŠ¶æ€
function toggleDebugPanel() {
  const content = document.getElementById('debug-content');
  const indicator = document.getElementById('debug-toggle-indicator');
  
  if (content.style.display === 'none') {
    content.style.display = 'block';
    indicator.textContent = '[ç‚¹å‡»æŠ˜å ]';
  } else {
    content.style.display = 'none';
    indicator.textContent = '[ç‚¹å‡»å±•å¼€]';
  }
}

// è°ƒæ•´è°ƒè¯•ç»Ÿè®¡å€¼
function adjustDebugStat(type, amount) {
  debugOffset[type] = (debugOffset[type] || 0) + amount;
  
  // æ›´æ–°å¯¹åº”çš„è¾“å…¥æ¡†
  let inputId = '';
  if (type === 'bossAtk') inputId = 'debug-boss-atk';
  else if (type === 'bossDef') inputId = 'debug-boss-def';
  else if (type === 'bossHp') inputId = 'debug-boss-hp';
  else if (type === 'minionAtk') inputId = 'debug-minion-atk';
  else if (type === 'minionDef') inputId = 'debug-minion-def';
  else if (type === 'minionHp') inputId = 'debug-minion-hp';
  
  if (inputId) {
    const input = document.getElementById(inputId);
    input.value = debugOffset[type];
    animateInput(input);
  }
  
  // æ›´æ–°UIæ˜¾ç¤º
  updateUI();
}

// è®¾ç½®è°ƒè¯•ç»Ÿè®¡å€¼
function setDebugStat(type) {
  let inputId = '';
  if (type === 'bossAtk') inputId = 'debug-boss-atk';
  else if (type === 'bossDef') inputId = 'debug-boss-def';
  else if (type === 'bossHp') inputId = 'debug-boss-hp';
  else if (type === 'minionAtk') inputId = 'debug-minion-atk';
  else if (type === 'minionDef') inputId = 'debug-minion-def';
  else if (type === 'minionHp') inputId = 'debug-minion-hp';
  
  if (inputId) {
    const input = document.getElementById(inputId);
    debugOffset[type] = parseInt(input.value) || 0;
    updateUI();
  }
}

// é‡ç½®æ‰€æœ‰è°ƒè¯•ç»Ÿè®¡å€¼
function resetDebugStats() {
  debugOffset = {
    bossAtk: 0,
    bossDef: 0,
    bossHp: 0,
    minionAtk: 0,
    minionDef: 0,
    minionHp: 0
  };
  
  // æ›´æ–°æ‰€æœ‰è¾“å…¥æ¡†
  document.getElementById('debug-boss-atk').value = 0;
  document.getElementById('debug-boss-def').value = 0;
  document.getElementById('debug-boss-hp').value = 0;
  document.getElementById('debug-minion-atk').value = 0;
  document.getElementById('debug-minion-def').value = 0;
  document.getElementById('debug-minion-hp').value = 0;
  
  updateUI();
}

function battleResultForBoss(lili, boss, bossBattleIdx, opts={}) {
  // ä¿å­˜åŸå§‹æœ€å¤§HPï¼Œç”¨äºæˆ˜æ–—ç»“æŸåæ¢å¤
  const originalMaxHp = lili.maxHp;
  
  // åº”ç”¨è°ƒè¯•åç§»é‡
  const debuggedBoss = getDebuggedBoss(boss);
  
  let liliHp = lili.hp;
  let bossHp = debuggedBoss.hp;
  let liliAtk = lili.atk;
  let liliDef = lili.def;
  
  if (bossBattleIdx === 7) {
    // ç¬¬8åªbossç‰¹æ®Šï¼šè¢«è§†ä¸ºå°æ€ªï¼Œä½¿ç”¨å°æ€ªæ”»å‡»å¢å¼º
    if (opts.optMinionAtk) liliAtk += 3;
  } else if (bossBattleIdx < 7) {
    // boss1-7ä½¿ç”¨å®ˆæŠ¤è€…æ”»å‡»å¢å¼ºï¼Œboss9å’Œboss10ä¸å±äºå®ˆæŠ¤è€…
    if (opts.optBossAtk) liliAtk += 2;
  }
  
  // ç¬¬ä¹å’Œç¬¬åbossï¼šè™šè¯†æ•ˆæœæ°¸ä¹…å¢åŠ æ”»å‡»7ç‚¹
  if (bossBattleIdx === 8 || bossBattleIdx === 9) {
    liliAtk += 7;
  }
  let bossAtk = debuggedBoss.atk;
  let round = 1;
  let bossSpecial = debuggedBoss.special;
  let hpConsumed = 0;
  let totalHpConsumed = 0; // æ€»æ¶ˆè€—è¡€é‡ï¼ŒåŒ…æ‹¬ç¥ˆç¥·æ¢å¤ååˆå‡å»çš„è¡€é‡
  let bossAlive = true;
  let liliAlive = true;
  let bossAtkInc = 0;
  let bossDeathDelay = 0;
  let prayCount = lili.pray;
  let prayAmount = opts.prayAmount || 0.3;
  let atkTimes = opts.atkTimes || 1;
  let optMolili = opts.optMolili;
  let optStatue = opts.optStatue;
  let optPrayCount = opts.optPrayCount;
  let optNoPray = opts.optNoPray;
  let optRestraint = opts.optRestraint;
  let optImmunity = opts.optImmunity;
  let optMinionAtk = opts.optMinionAtk;
  let damageLog = [];

  while (liliAlive && bossAlive && round < 1000) {
    // è‰è‰æ”»å‡»
    for (let t = 0; t < atkTimes; t++) {
      let liliDmg = Math.max(1, liliAtk - debuggedBoss.def);
      // bossç‰¹æ®Šï¼šæ¯æ¬¡å—ä¼¤æœ€é«˜10ç‚¹
      if (bossBattleIdx === 5) liliDmg = Math.min(liliDmg, 10);
      bossHp -= liliDmg;
      if (round <= 30) damageLog.push(`${round}:è‰è‰å¯¹Bossé€ æˆ${liliDmg}ç‚¹ä¼¤å®³`);
      // bossç‰¹æ®Šï¼šhpä¸º0åå—åˆ°5æ¬¡æ”»å‡»æ­»äº¡
      if (bossBattleIdx === 7 && bossHp <= 0) {
        bossDeathDelay++;
        if (bossDeathDelay < 5) bossAlive = true;
        else bossAlive = false;
      } else if (bossHp <= 0) {
        bossAlive = false;
      }
    }
    
    // ç¥ˆç¥·æŠ€èƒ½ï¼ˆè‰è‰æ”»å‡»åï¼Œæ•Œæ–¹æ”»å‡»å‰ï¼‰
    if (!optNoPray && liliHp > 0 && liliHp <= Math.floor(lili.maxHp * 0.3) && prayCount > 0) {
      let heal = Math.floor(lili.maxHp * prayAmount);
      
      // å…ˆæŒ‰åŸæœ€å¤§HPç¥ˆç¥·å›è¡€
      liliHp += heal;
      prayCount--;
      
      // ç™½å·«å¥³å¨ƒå¨ƒç‰¹æ®Šæ•ˆæœï¼šç¥ˆç¥·åä¸´æ—¶å¢åŠ 4ç‚¹æœ€å¤§HPï¼ˆä»…æˆ˜æ–—ä¸­æœ‰æ•ˆï¼‰
      let maxHpIncrease = 0;
      if (optPrayCount) {
        maxHpIncrease = 4;
        // æ³¨æ„ï¼šè¿™é‡Œä¸ä¿®æ”¹lili.maxHpï¼Œè€Œæ˜¯åœ¨æˆ˜æ–—ä¸­ä¸´æ—¶è°ƒæ•´æœ€å¤§è¡€é‡é™åˆ¶
      }
      
      // ç™½å·«å¥³é›•åƒæ•ˆæœï¼šç¥ˆç¥·å¯¹æ•Œäººé€ æˆæ¢å¤é‡ä¸€åŠçš„ä¼¤å®³ï¼ˆè®¡ç®—é˜²å¾¡ï¼‰
      if (optStatue) {
        let statueDmg = Math.max(1, Math.floor(heal / 2) - debuggedBoss.def);
        // bossç‰¹æ®Šï¼šæ¯æ¬¡å—ä¼¤æœ€é«˜10ç‚¹
        if (bossBattleIdx === 5) statueDmg = Math.min(statueDmg, 10);
        bossHp -= statueDmg;
        if (round <= 30) {
          let logMessage = `${round}:æ”»å‡»å:è‰è‰è§¦å‘ç¥ˆç¥·ï¼Œæ¢å¤${heal}ç‚¹ç”Ÿå‘½`;
          if (maxHpIncrease > 0) logMessage += `ï¼ˆå¨ƒå¨ƒæ•ˆæœ+${maxHpIncrease}æœ€å¤§HPï¼‰`;
          logMessage += `ï¼Œé›•åƒæ•ˆæœå¯¹Bossé€ æˆ${statueDmg}ç‚¹ä¼¤å®³`;
          damageLog.push(logMessage);
        }
      } else {
        if (round <= 30) {
          let logMessage = `${round}:æ”»å‡»å:è‰è‰è§¦å‘ç¥ˆç¥·ï¼Œæ¢å¤${heal}ç‚¹ç”Ÿå‘½`;
          if (maxHpIncrease > 0) logMessage += `ï¼ˆå¨ƒå¨ƒæ•ˆæœ+${maxHpIncrease}æœ€å¤§HPï¼‰`;
          damageLog.push(logMessage);
        }
      }
    }
    
    // bossç‰¹æ®Šï¼šæ¯å›åˆç§»é™¤å¯¹æ–¹12hpï¼ˆç¦é”¢æ—¶ç¬¬ä¸€å›åˆä¸ç”Ÿæ•ˆï¼‰
    if (bossBattleIdx === 3 && bossAlive && !optImmunity && !(opts.optRestraint && round === 1)) {
      liliHp -= 12;
      totalHpConsumed += 12; // è®°å½•æ€»æ¶ˆè€—è¡€é‡
      if (round <= 30) damageLog.push(`${round}:Bossç‰¹æ®Šç§»é™¤è‰è‰12ç‚¹ç”Ÿå‘½`);
    } else if (bossBattleIdx === 3 && bossAlive && optImmunity && !(opts.optRestraint && round === 1) && round <= 30) {
      damageLog.push(`${round}:Bossç‰¹æ®Šæ”»å‡»è¢«å…ç–«æ— æ•ˆ`);
    } else if (bossBattleIdx === 3 && bossAlive && opts.optRestraint && round === 1 && round <= 30) {
      damageLog.push(`${round}:Bossè¢«ç¦é”¢ï¼Œç‰¹æ®Šæ•ˆæœè¢«é˜»æ­¢`);
    }
    
    // bossç‰¹æ®Šï¼šæ¯ä¸‰å›åˆæ”»å‡»ä¸€æ¬¡ï¼ˆç¦é”¢ä¼šè·³è¿‡ç¬¬ä¸€æ¬¡æ”»å‡»ï¼‰
    let bossAttackThisRound = true;
    if (bossBattleIdx === 4) {
      if (opts.optRestraint) {
        // æœ‰ç¦é”¢æ•ˆæœæ—¶ï¼Œè·³è¿‡ç¬¬3å›åˆçš„æ”»å‡»ï¼Œä»ç¬¬6å›åˆå¼€å§‹ï¼šç¬¬6ã€9ã€12å›åˆæ”»å‡»
        bossAttackThisRound = (round % 3 === 0 && round > 3);
      } else {
        // æ²¡æœ‰ç¦é”¢æ•ˆæœæ—¶ï¼Œæ­£å¸¸å‘¨æœŸï¼šç¬¬3ã€6ã€9å›åˆæ”»å‡»
        bossAttackThisRound = (round % 3 === 0);
      }
    }
    
    // bossç‰¹æ®Šï¼šæ¯å›åˆæ”»å‡»ä¸¤æ¬¡
    let bossAttackTimes = (bossBattleIdx === 2) ? 2 : 1;
    
    // ç¬¬ååªbossç‰¹æ®Šï¼šè¡€é‡å°äºç­‰äº25%æ—¶ä¸å†æ”»å‡»
    if (bossBattleIdx === 9 && bossHp <= boss.hp * 0.25) {
      bossAttackTimes = 0;
      if (round <= 30) damageLog.push(`${round}:Bossè¡€é‡ä½äº25%ï¼Œåœæ­¢æ”»å‡»`);
    }
    
    for (let i = 0; i < bossAttackTimes; i++) {
      if (bossAlive && bossAttackThisRound && !(opts.optRestraint && round === 1)) {
        let def = liliDef;
        // bossç‰¹æ®Šï¼šæ— è§†50%é˜²å¾¡
        if (bossBattleIdx === 6) def = Math.floor(def / 2);
        let bossDmg = Math.max(1, bossAtk - def);
        liliHp -= bossDmg;
        hpConsumed += bossDmg;
        totalHpConsumed += bossDmg; // è®°å½•æ€»æ¶ˆè€—è¡€é‡
        if (round <= 30) damageLog.push(`${round}:Bosså¯¹è‰è‰é€ æˆ${bossDmg}ç‚¹ä¼¤å®³`);

        // èŠ™è‰è’‚é›…çš„æˆ’æŒ‡æ•ˆæœï¼šåå¼¹é˜²å¾¡åŠ›ä¼¤å®³
        if (opts.optMolili && bossDmg > 0) {
          let reflect = Math.max(1, liliDef - debuggedBoss.def);
          // bossç‰¹æ®Šï¼šæ¯æ¬¡å—ä¼¤æœ€é«˜10ç‚¹
          if (bossBattleIdx === 5) reflect = Math.min(reflect, 10);
          bossHp -= reflect;
          if (round <= 30) damageLog.push(`${round}:èŠ™è‰è’‚é›…çš„æˆ’æŒ‡åå¼¹${reflect}ç‚¹ä¼¤å®³ç»™Boss`);
        }
        
        if (liliHp <= 0) liliAlive = false;
      }
    }
    
    // bossç‰¹æ®Šï¼šæ¯æ¬¡æ”»å‡»åå¢åŠ è‡ªèº«atkä¸€ç‚¹ï¼ˆä½†å—åˆ°é­”çº¿è„šé“¾å½±å“æ—¶ä¸å¢åŠ ï¼‰
    if (bossBattleIdx === 1 && bossAlive && !(opts.optRestraint && round === 1)) {
      bossAtk++;
      if (round <= 30) damageLog.push(`${round}:Bossæ”»å‡»åŠ›å¢åŠ 1ç‚¹ï¼Œå½“å‰æ”»å‡»åŠ›${bossAtk}`);
    }
    
    round++;
  }
  
  return { win: bossAlive === false && liliAlive, remainingHp: liliHp, remainingPray: prayCount, totalHpConsumed: totalHpConsumed, damageLog: damageLog };
}

function battleResult(lili, boss, opts={}) {
  // ä¿å­˜åŸå§‹æœ€å¤§HPï¼Œç”¨äºæˆ˜æ–—ç»“æŸåæ¢å¤
  const originalMaxHp = lili.maxHp;
  
  // åº”ç”¨è°ƒè¯•åç§»é‡
  const debuggedBoss = getDebuggedBoss(boss);
  
  let liliHp = lili.hp; // ä½¿ç”¨å½“å‰è¡€é‡è€Œä¸æ˜¯æœ€å¤§è¡€é‡
  let bossHp = debuggedBoss.hp;
  let liliAtk = lili.atk;
  if (bossIdx === 7) {
    // ç¬¬8åªbossç‰¹æ®Šï¼šè¢«è§†ä¸ºå°æ€ªï¼Œä½¿ç”¨å°æ€ªæ”»å‡»å¢å¼º
    if (opts.optMinionAtk) liliAtk += 3;
  } else if (bossIdx < 7) {
    // boss1-7ä½¿ç”¨å®ˆæŠ¤è€…æ”»å‡»å¢å¼ºï¼Œboss9å’Œboss10ä¸å±äºå®ˆæŠ¤è€…
    if (opts.optBossAtk) liliAtk += 2; // å¯¹bossæ”»å‡»åŠ›+2
  }
  
  // ç¬¬ä¹å’Œç¬¬åbossï¼šè™šè¯†æ•ˆæœæ°¸ä¹…å¢åŠ æ”»å‡»7ç‚¹
  if (bossIdx === 8 || bossIdx === 9) {
    liliAtk += 7;
  }
  let bossAtk = debuggedBoss.atk;
  let round = 1;
  let bossSpecial = debuggedBoss.special;
  let hpConsumed = 0;
  let totalHpConsumed = 0; // æ€»æ¶ˆè€—è¡€é‡ï¼ŒåŒ…æ‹¬ç¥ˆç¥·æ¢å¤ååˆå‡å»çš„è¡€é‡
  let bossAlive = true;
  let liliAlive = true;
  let bossAtkInc = 0;
  let bossDeathDelay = 0;
  let prayCount = lili.pray; // ä½¿ç”¨å½“å‰ç¥ˆç¥·æ¬¡æ•°
  let prayAmount = opts.prayAmount || 0.3;
  let atkTimes = opts.atkTimes || 1;
  let optMolili = opts.optMolili;
  let optStatue = opts.optStatue;
  let optPrayCount = opts.optPrayCount;
  let optNoPray = opts.optNoPray;
  let optRestraint = opts.optRestraint;
  let optImmunity = opts.optImmunity;
  let optMinionAtk = opts.optMinionAtk;
  let damageLog = [];

  while (liliAlive && bossAlive && round < 1000) {
    // è‰è‰æ”»å‡»
    for (let t = 0; t < atkTimes; t++) {
      let liliDmg = Math.max(1, liliAtk - debuggedBoss.def);
      // bossç‰¹æ®Šï¼šæ¯æ¬¡å—ä¼¤æœ€é«˜10ç‚¹
      if (bossIdx === 5) liliDmg = Math.min(liliDmg, 10);
      bossHp -= liliDmg;
      if (round <= 30) damageLog.push(`${round}:è‰è‰å¯¹Bossé€ æˆ${liliDmg}ç‚¹ä¼¤å®³`);
      // bossç‰¹æ®Šï¼šhpä¸º0åå—åˆ°5æ¬¡æ”»å‡»æ­»äº¡
      if (bossIdx === 7 && bossHp <= 0) {
        bossDeathDelay++;
        if (bossDeathDelay < 5) bossAlive = true;
        else bossAlive = false;
      } else if (bossHp <= 0) {
        bossAlive = false;
      }
    }
    
    // ç¥ˆç¥·æŠ€èƒ½ï¼ˆè‰è‰æ”»å‡»åï¼Œæ•Œæ–¹æ”»å‡»å‰ï¼‰
    if (!optNoPray && liliHp > 0 && liliHp <= Math.floor(lili.maxHp * 0.3) && prayCount > 0) {
      let heal = Math.floor(lili.maxHp * prayAmount);
      
      // å…ˆæŒ‰åŸæœ€å¤§HPç¥ˆç¥·å›è¡€
      liliHp += heal;
      prayCount--;
      
      // ç™½å·«å¥³å¨ƒå¨ƒç‰¹æ®Šæ•ˆæœï¼šç¥ˆç¥·åä¸´æ—¶å¢åŠ 4ç‚¹æœ€å¤§HPï¼ˆä»…æˆ˜æ–—ä¸­æœ‰æ•ˆï¼‰
      let maxHpIncrease = 0;
      if (optPrayCount) {
        maxHpIncrease = 4;
        // æ³¨æ„ï¼šè¿™é‡Œä¸ä¿®æ”¹lili.maxHpï¼Œè€Œæ˜¯åœ¨æˆ˜æ–—ä¸­ä¸´æ—¶è°ƒæ•´æœ€å¤§è¡€é‡é™åˆ¶
      }
      
      // åº”ç”¨ä¸´æ—¶æœ€å¤§HPå¢åŠ ï¼Œç¡®ä¿HPä¸è¶…è¿‡ä¸´æ—¶ä¸Šé™
      let tempMaxHp = lili.maxHp + maxHpIncrease;
      if (liliHp > tempMaxHp) {
        liliHp = tempMaxHp;
      }
      
      // ç™½å·«å¥³é›•åƒæ•ˆæœï¼šç¥ˆç¥·å¯¹æ•Œäººé€ æˆæ¢å¤é‡ä¸€åŠçš„ä¼¤å®³ï¼ˆè®¡ç®—é˜²å¾¡ï¼‰
      if (optStatue) {
        let statueDmg = Math.max(1, Math.floor(heal / 2) - debuggedBoss.def);
        // bossç‰¹æ®Šï¼šæ¯æ¬¡å—ä¼¤æœ€é«˜10ç‚¹
        if (bossIdx === 5) statueDmg = Math.min(statueDmg, 10);
        bossHp -= statueDmg;
        if (round <= 30) {
          let logMessage = `${round}:æ”»å‡»å:è‰è‰è§¦å‘ç¥ˆç¥·ï¼Œæ¢å¤${heal}ç‚¹ç”Ÿå‘½`;
          if (maxHpIncrease > 0) logMessage += `ï¼ˆå¨ƒå¨ƒæ•ˆæœ+${maxHpIncrease}æœ€å¤§HPï¼‰`;
          logMessage += `ï¼Œé›•åƒæ•ˆæœå¯¹Bossé€ æˆ${statueDmg}ç‚¹ä¼¤å®³`;
          damageLog.push(logMessage);
        }
      } else {
        if (round <= 30) {
          let logMessage = `${round}:æ”»å‡»å:è‰è‰è§¦å‘ç¥ˆç¥·ï¼Œæ¢å¤${heal}ç‚¹ç”Ÿå‘½`;
          if (maxHpIncrease > 0) logMessage += `ï¼ˆå¨ƒå¨ƒæ•ˆæœ+${maxHpIncrease}æœ€å¤§HPï¼‰`;
          damageLog.push(logMessage);
        }
      }
    }
    
    // bossç‰¹æ®Šï¼šæ¯å›åˆç§»é™¤å¯¹æ–¹12hpï¼ˆç¦é”¢æ—¶ç¬¬ä¸€å›åˆä¸ç”Ÿæ•ˆï¼‰
    if (bossIdx === 3 && bossAlive && !optImmunity && !(optRestraint && round === 1)) {
      liliHp -= 12;
      totalHpConsumed += 12; // è®°å½•æ€»æ¶ˆè€—è¡€é‡
      if (round <= 30) damageLog.push(`${round}:Bossç‰¹æ®Šç§»é™¤è‰è‰12ç‚¹ç”Ÿå‘½`);
    } else if (bossIdx === 3 && bossAlive && optImmunity && !(optRestraint && round === 1) && round <= 30) {
      damageLog.push(`${round}:Bossç‰¹æ®Šæ”»å‡»è¢«å…ç–«æ— æ•ˆ`);
    } else if (bossIdx === 3 && bossAlive && optRestraint && round === 1 && round <= 30) {
      damageLog.push(`${round}:Bossè¢«ç¦é”¢ï¼Œç‰¹æ®Šæ•ˆæœè¢«é˜»æ­¢`);
    }
    
    // bossç‰¹æ®Šï¼šæ¯ä¸‰å›åˆæ”»å‡»ä¸€æ¬¡ï¼ˆç¦é”¢ä¼šè·³è¿‡ç¬¬ä¸€æ¬¡æ”»å‡»ï¼‰
    let bossAttackThisRound = true;
    if (bossIdx === 4) {
      if (optRestraint) {
        // æœ‰ç¦é”¢æ•ˆæœæ—¶ï¼Œè·³è¿‡ç¬¬3å›åˆçš„æ”»å‡»ï¼Œä»ç¬¬6å›åˆå¼€å§‹ï¼šç¬¬6ã€9ã€12å›åˆæ”»å‡»
        bossAttackThisRound = (round % 3 === 0 && round > 3);
      } else {
        // æ²¡æœ‰ç¦é”¢æ•ˆæœæ—¶ï¼Œæ­£å¸¸å‘¨æœŸï¼šç¬¬3ã€6ã€9å›åˆæ”»å‡»
        bossAttackThisRound = (round % 3 === 0);
      }
    }
    
    // bossç‰¹æ®Šï¼šæ¯å›åˆæ”»å‡»ä¸¤æ¬¡
    let bossAttackTimes = (bossIdx === 2) ? 2 : 1;
    
    // ç¬¬ååªbossç‰¹æ®Šï¼šè¡€é‡å°äºç­‰äº25%æ—¶ä¸å†æ”»å‡»
    if (bossIdx === 9 && bossHp <= boss.hp * 0.25) {
      bossAttackTimes = 0;
      if (round <= 30) damageLog.push(`${round}:Bossè¡€é‡ä½äº25%ï¼Œåœæ­¢æ”»å‡»`);
    }
    
    for (let i = 0; i < bossAttackTimes; i++) {
      if (bossAlive && bossAttackThisRound && !(optRestraint && round === 1)) { // ç¦é”¢æ—¶æ•Œæ–¹é¦–è½®ä¸èƒ½æ”»å‡»
        let def = lili.def;
        // bossç‰¹æ®Šï¼šæ— è§†50%é˜²å¾¡
        if (bossIdx === 6) def = Math.floor(def / 2);
        let bossDmg = Math.max(1, bossAtk - def);
        liliHp -= bossDmg;
        hpConsumed += bossDmg;
        totalHpConsumed += bossDmg; // è®°å½•æ€»æ¶ˆè€—è¡€é‡
        if (round <= 30) damageLog.push(`${round}:Bosså¯¹è‰è‰é€ æˆ${bossDmg}ç‚¹ä¼¤å®³`);
        
        // è«è‰è‰çš„æˆ’æŒ‡æ•ˆæœï¼šåå¼¹é˜²å¾¡åŠ›ä¼¤å®³
        if (optMolili && bossDmg > 0) {
          let reflect = Math.max(1, lili.def - debuggedBoss.def);
          // bossç‰¹æ®Šï¼šæ¯æ¬¡å—ä¼¤æœ€é«˜10ç‚¹
          if (bossIdx === 5) reflect = Math.min(reflect, 10);
          bossHp -= reflect;
          if (round <= 30) damageLog.push(`${round}:è«è‰è‰çš„æˆ’æŒ‡åå¼¹${reflect}ç‚¹ä¼¤å®³ç»™Boss`);
        }
        
        if (liliHp <= 0) liliAlive = false;
      }
    }
    
    // bossç‰¹æ®Šï¼šæ¯æ¬¡æ”»å‡»åå¢åŠ è‡ªèº«atkä¸€ç‚¹ï¼ˆä½†å—åˆ°é­”çº¿è„šé“¾å½±å“æ—¶ä¸å¢åŠ ï¼‰
    if (bossIdx === 1 && bossAlive && !(optRestraint && round === 1)) {
      bossAtk++;
      if (round <= 30) damageLog.push(`${round}:Bossæ”»å‡»åŠ›å¢åŠ 1ç‚¹ï¼Œå½“å‰æ”»å‡»åŠ›${bossAtk}`);
    }
    
    round++;
  }
  
  // æ¢å¤åŸå§‹æœ€å¤§HPï¼ˆé˜²æ­¢å½±å“åç»­æ“ä½œï¼‰
  lili.maxHp = originalMaxHp;
  
  return { win: bossAlive === false && liliAlive, remainingHp: liliHp, remainingPray: prayCount, totalHpConsumed: totalHpConsumed, damageLog: damageLog };
}

function minionBattleResult(lili, minion, minionBattleIdx, opts={}) {
  // åº”ç”¨è°ƒè¯•åç§»é‡
  const debuggedMinion = getDebuggedMinion(minion);
  
  let liliHp = lili.hp; // ä½¿ç”¨ä¼ å…¥çš„å½“å‰è¡€é‡
  let minionHp = debuggedMinion.hp;
  let liliAtk = lili.atk;
  let liliDef = lili.def;
  
  if (opts.optMinionAtk) liliAtk += 3; // å¯¹å°æ€ªæ”»å‡»åŠ›+3
  let minionAtk = debuggedMinion.atk;
  let round = 1;
  let minionAlive = true;
  let liliAlive = true;
  let prayCount = lili.pray; // ç”¨å½“å‰ç¥ˆç¥·æ¬¡æ•°
  let prayAmount = opts.prayAmount || 0.3;
  let atkTimes = opts.atkTimes || 1;
  let optMolili = opts.optMolili;
  let optStatue = opts.optStatue;
  let optNoPray = opts.optNoPray;
  let optRestraint = opts.optRestraint;
  let optImmunity = opts.optImmunity;
  
  while (liliAlive && minionAlive && round < 1000) {
    // è‰è‰æ”»å‡»
    for (let t = 0; t < atkTimes; t++) {
      let liliDmg = Math.max(1, liliAtk - debuggedMinion.def);
      minionHp -= liliDmg;
    }
    
    // ç¥ˆç¥·æŠ€èƒ½ï¼ˆè‰è‰æ”»å‡»åï¼Œæ•Œæ–¹æ”»å‡»å‰ï¼‰
    if (!optNoPray && liliHp > 0 && liliHp <= Math.floor(lili.maxHp * 0.3) && prayCount > 0) {
      let heal = Math.floor(lili.maxHp * prayAmount);
      
      // å…ˆæŒ‰åŸæœ€å¤§HPç¥ˆç¥·å›è¡€
      liliHp += heal;
      prayCount--;
      
      // ç™½å·«å¥³å¨ƒå¨ƒç‰¹æ®Šæ•ˆæœï¼šç¥ˆç¥·åä¸´æ—¶å¢åŠ 4ç‚¹æœ€å¤§HPï¼ˆä»…æˆ˜æ–—ä¸­æœ‰æ•ˆï¼‰
      let maxHpIncrease = 0;
      if (opts.optPrayCount) {
        maxHpIncrease = 4;
        // æ³¨æ„ï¼šè¿™é‡Œä¸ä¿®æ”¹lili.maxHpï¼Œè€Œæ˜¯åœ¨æˆ˜æ–—ä¸­ä¸´æ—¶è°ƒæ•´æœ€å¤§è¡€é‡é™åˆ¶
      }
      
      // åº”ç”¨ä¸´æ—¶æœ€å¤§HPå¢åŠ ï¼Œç¡®ä¿HPä¸è¶…è¿‡ä¸´æ—¶ä¸Šé™
      let tempMaxHp = lili.maxHp + maxHpIncrease;
      if (liliHp > tempMaxHp) {
        liliHp = tempMaxHp;
      }
      
      // ç™½å·«å¥³é›•åƒæ•ˆæœï¼šç¥ˆç¥·å¯¹æ•Œäººé€ æˆæ¢å¤é‡ä¸€åŠçš„ä¼¤å®³ï¼ˆè®¡ç®—é˜²å¾¡ï¼‰
      if (optStatue) {
        let statueDmg = Math.max(1, Math.floor(heal / 2) - debuggedMinion.def);
        minionHp -= statueDmg;
      }
    }
    
    // å°æ€ªç‰¹æ®Šï¼šåå¼¹100%çœŸå®ä¼¤å®³
    if (minionBattleIdx === 8 && minion.special === 'åå¼¹100%çœŸå®ä¼¤å®³' && !optImmunity) {
      liliHp -= liliAtk;
    }
    
    if (minionHp <= 0) {
      minionAlive = false;
    }
    
    // å°æ€ªæ”»å‡»
    if (minionAlive && !(opts.optRestraint && round === 1) && !(minionBattleIdx === 8)) { // ç¦é”¢æ—¶æ•Œæ–¹é¦–è½®ä¸èƒ½æ”»å‡»ï¼Œç¬¬ä¹å…³å°æ€ªä¸ä¼šå‘åŠ¨æ”»å‡»
      let minionDmg = Math.max(1, minionAtk - liliDef);
      liliHp -= minionDmg;
      
      // è«è‰è‰çš„æˆ’æŒ‡æ•ˆæœï¼šåå¼¹é˜²å¾¡åŠ›ä¼¤å®³
      if (opts.optMolili && minionDmg > 0) {
        let reflect = Math.max(1, liliDef - debuggedMinion.def);
        minionHp -= reflect;
      }
      
      if (liliHp <= 0) liliAlive = false;
    }
    round++;
  }
  
  return { win: minionAlive === false && liliAlive, finalHp: liliHp, prayRemaining: prayCount };
}

updateUI();
</script>

</div>

<!-- ä½¿ç”¨è¯´æ˜æ‚¬æµ®çª— -->
<div id="helpModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeHelpModal()">&times;</span>
    <h3 class="modal-title">æ¨¡æ‹Ÿå™¨ä½¿ç”¨è¯´æ˜</h3>
    <div id="helpContent">
      <!-- è¯´æ˜å†…å®¹å°†åœ¨è¿™é‡Œæ·»åŠ  -->
      <p>1. åŠ ç‚¹æ¨èä»…è®¡ç®—æ»¡çŠ¶æ€æ‰“å½“å‰bossï¼Œä»…ä¾›å‚è€ƒï¼Œå»ºè®®åˆ‡æ¢bossè¡¡é‡</p>
      <p>2. æ‰“å®Œbossåï¼Œè®°å¾—åˆ‡æ¢bossï¼Œé‡ç½®çŠ¶æ€</p>
      <p>3. éƒ¨åˆ†bossåŸæ¸¸æˆä¸­æ˜¾ç¤ºå€¼ç–‘ä¼¼å­˜åœ¨é—®é¢˜ï¼Œå·²æŒ‰æ¨æµ‹å€¼ä¿®æ”¹ï¼Œå¦‚boss3çš„æ”»å‡»ï¼Œboss7çš„é˜²å¾¡</p>
      <p>4. è®¡ç®—å¯èƒ½å­˜åœ¨ä¸åŸæ¸¸æˆä¸ç¬¦çš„æƒ…å†µï¼Œå·²çŸ¥çš„æœ‰ï¼šboss8ã€boss10ã€è£…å¤‡æ‰‹å¥—+è„šé“¾æ—¶çš„å°æ€ªæ‰è¡€ï¼Œå¾é›†çº¿ç´¢ä¸­</p>
      <p>5. ç™½å¥³å·«å¨ƒå¨ƒçš„è¡€ä¸Šé™éœ€æ‰‹åŠ¨æ›´æ–°ï¼›åŸºäºæ±¡ç§½å€¼æå‡æ”»é˜²è¡€çš„è£…å¤‡éœ€åˆ‡æ¢bossæ”¹å˜äº†å€¼æ‰ä¼šæ›´æ–°é¢„æµ‹</p>
      <p>6. å‹æƒ…æé†’ï¼š0æ­»TEåœ¨ç¬¬ä¹å…³bosså‰è®°å¾—æŠ½åˆ°çŸ³æ¿</p>
      <p>7. å£°æ˜ï¼šä½¿ç”¨æœ¬è®¡ç®—å™¨é€ æˆå¯èƒ½çš„è®¡ç®—é”™è¯¯é—®é¢˜æˆ–é˜Ÿå‹ç­‰å¾…æ—¶é—´å˜é•¿ç­‰é—®é¢˜ä¸ä½œè€…æ— å…³</p>
    </div>
  </div>
</div>

<!-- è°ƒè¯•é¢æ¿ -->
<div id="debug-panel" style="position: fixed; top: 20px; right: 10px; width: 320px; z-index: 1000; border: 2px solid #888; border-radius: 8px; background: #f9f9f9; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
  <div style="background: #ddd; padding: 8px; border-radius: 6px 6px 0 0; cursor: pointer; user-select: none;" onclick="toggleDebugPanel()">
    <strong>ğŸ”§ è°ƒè¯•é¢æ¿</strong> <span id="debug-toggle-indicator">[ç‚¹å‡»å±•å¼€]</span>
  </div>
  <div id="debug-content" style="display: none; padding: 15px; max-height: 70vh; overflow-y: auto;">
    <div style="display: flex; flex-direction: column; gap: 15px;">
      <!-- Bossåç§»é‡ -->
      <div>
        <h4 style="margin: 0 0 10px 0; color: #d32f2f; font-size: 14px;">Bosså±æ€§åç§»é‡</h4>
        <div class="stat-input-container" style="margin-bottom: 8px;">
          æ”»å‡»åç§»ï¼š<button class="arrow-btn" onclick="adjustDebugStat('bossAtk', -1)">â—€</button><input type="number" id="debug-boss-atk" value="0" style="width:40px;text-align:center;font-size:14px;" onchange="setDebugStat('bossAtk')" oninput="animateInput(this)"><button class="arrow-btn" onclick="adjustDebugStat('bossAtk', 1)">â–¶</button>
        </div>
        <div class="stat-input-container" style="margin-bottom: 8px;">
          é˜²å¾¡åç§»ï¼š<button class="arrow-btn" onclick="adjustDebugStat('bossDef', -1)">â—€</button><input type="number" id="debug-boss-def" value="0" style="width:40px;text-align:center;font-size:14px;" onchange="setDebugStat('bossDef')" oninput="animateInput(this)"><button class="arrow-btn" onclick="adjustDebugStat('bossDef', 1)">â–¶</button>
        </div>
        <div class="stat-input-container" style="margin-bottom: 8px;">
          è¡€é‡åç§»ï¼š<button class="arrow-btn" onclick="adjustDebugStat('bossHp', -1)">â—€</button><input type="number" id="debug-boss-hp" value="0" style="width:40px;text-align:center;font-size:14px;" onchange="setDebugStat('bossHp')" oninput="animateInput(this)"><button class="arrow-btn" onclick="adjustDebugStat('bossHp', 1)">â–¶</button>
        </div>
      </div>
      
      <!-- å°æ€ªåç§»é‡ -->
      <div>
        <h4 style="margin: 0 0 10px 0; color: #388e3c; font-size: 14px;">å°æ€ªå±æ€§åç§»é‡</h4>
        <div class="stat-input-container" style="margin-bottom: 8px;">
          æ”»å‡»åç§»ï¼š<button class="arrow-btn" onclick="adjustDebugStat('minionAtk', -1)">â—€</button><input type="number" id="debug-minion-atk" value="0" style="width:40px;text-align:center;font-size:14px;" onchange="setDebugStat('minionAtk')" oninput="animateInput(this)"><button class="arrow-btn" onclick="adjustDebugStat('minionAtk', 1)">â–¶</button>
        </div>
        <div class="stat-input-container" style="margin-bottom: 8px;">
          é˜²å¾¡åç§»ï¼š<button class="arrow-btn" onclick="adjustDebugStat('minionDef', -1)">â—€</button><input type="number" id="debug-minion-def" value="0" style="width:40px;text-align:center;font-size:14px;" onchange="setDebugStat('minionDef')" oninput="animateInput(this)"><button class="arrow-btn" onclick="adjustDebugStat('minionDef', 1)">â–¶</button>
        </div>
        <div class="stat-input-container" style="margin-bottom: 8px;">
          è¡€é‡åç§»ï¼š<button class="arrow-btn" onclick="adjustDebugStat('minionHp', -1)">â—€</button><input type="number" id="debug-minion-hp" value="0" style="width:40px;text-align:center;font-size:14px;" onchange="setDebugStat('minionHp')" oninput="animateInput(this)"><button class="arrow-btn" onclick="adjustDebugStat('minionHp', 1)">â–¶</button>
        </div>
      </div>
    </div>
    
    <div style="margin-top: 15px; padding-top: 10px; border-top: 1px solid #ccc;">
      <button style="padding: 4px 8px; background: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;" onclick="resetDebugStats()">é‡ç½®åç§»é‡</button>
      <div style="margin-top: 8px; font-size: 11px; color: #666;">æ³¨æ„ï¼šåç§»é‡ä¼šåº”ç”¨åˆ°æ‰€æœ‰æˆ˜æ–—è®¡ç®—ä¸­</div>
    </div>
  </div>
</div>

</body>
</html>